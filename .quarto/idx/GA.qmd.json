{"title":"Genetic Algorithms in R","markdown":{"yaml":{"title":"Genetic Algorithms in R","subtitle":"Viá»‡t Nam, 2024","categories":["SupplyChainManagement","Logistics","Genetic Algorithm"],"description":"ÄÃ¢y lÃ  bÃ i viáº¿t cá»§a tÃ´i vá» cÃ¡ch sá»­ dá»¥ng R trong á»©ng dá»¥ng Genetic Algorithm trong Supply Chain","number-sections":true,"format":{"html":{"code-fold":true,"code-tools":true}},"crossref":{"labels":"alpha a","subref-labels":"roman"},"filters":["quarto-ext/shinylive"],"bibliography":"references.bib"},"headingText":"Giá»›i thiá»‡u:","containsRefs":false,"markdown":"\n\n\n```{r}\n#| warning: false\n#| message: false\n#| echo: false\n#Call packages\npacman::p_load(rio,\n               here,\n               janitor,\n               tidyverse,\n               dplyr,\n               magrittr,\n               ggplot2,\n               purrr,\n               lubridate,\n               mice,\n               plotly,\n               DiagrammeR,\n               shinylive)\n```\n\n## VÃ i Ä‘iá»ƒm vá» thuáº­t toÃ¡n Genetic:\n\n**GA** hay **Genetic Algorithm** lÃ  1 thuáº­t toÃ¡n tá»‘i Æ°u hÃ³a ngáº«u nhiÃªn (**stochastic search algorithms**), Ä‘Æ°á»£c phÃ¡t triá»ƒn dá»±a trÃªn lÃ½ thuyáº¿t tiáº¿n hÃ³a vÃ  sá»± chá»n lá»c tá»± nhiÃªn cá»§a sinh há»c [@lucascrucca2013].\n\ná» thá»i cáº¥p 3, báº¡n Ä‘Ã£ tá»«ng há»c vá» lÃ½ thuyáº¿t tiáº¿n hÃ³a vÃ  chá»n lá»c tá»± nhiÃªn cá»§a [Charles Darwin](https://vi.wikipedia.org/wiki/Charles_Darwin) vÃ  [Alfred Russel](https://vi.wikipedia.org/wiki/Alfred_Russel_Wallace) á»Ÿ mÃ´n Sinh há»c. Náº¿u báº¡n cÅ©ng tá»«ng liá»‡t Sinh nhÆ° tÃ´i thÃ¬ báº¡n quÃªn cÅ©ng khÃ´ng sao ğŸ˜…ğŸ˜…. Váº­y thÃ¬ Ä‘á»ƒ tÃ´i giáº£i thÃ­ch láº¡i nhÆ° sau:\n\nSá»± tiáº¿n hÃ³a lÃ  sá»± thay Ä‘á»•i Ä‘áº·c Ä‘iá»ƒm di truyá»n cá»§a 1 quáº§n thá»ƒ sinh váº­t, vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh chÃ­nh lÃ  tá»« loáº¡i vÆ°á»£n Ä‘Ã£ tiáº¿n hÃ³a thÃ nh hÃ¬nh dáº¡ng con ngÆ°á»i vÄƒn minh nhÆ° cÃ¡c báº¡n bÃ¢y giá». Váº­y quÃ¡ trÃ¬nh tiáº¿n hÃ³a Ä‘Ã³ diá»…n ra khi cÃ³ sá»± chá»n lá»c tá»± nhiÃªn táº¡o ra cÃ¡c biáº¿n dá»‹ di truyá»n (VÃ­ dá»¥: Ä‘á»™t biáº¿n,...) vÃ  káº¿t quáº£ lÃ  cÃ¡c cÃ¡ thá»ƒ Ä‘á»™t biáº¿n trá»Ÿ nÃªn phá»• biáº¿n hÆ¡n hoáº·c hiáº¿m gáº·p hÆ¡n trong quáº§n thá»ƒ. Váº­y Ä‘iá»u kiá»‡n Ä‘á»ƒ xáº£y ra sá»± chá»n lá»c tá»± nhiÃªn cÃ³ thá»ƒ lÃ  sá»± thay Ä‘á»•i vá» mÃ´i trÆ°á»ng sá»‘ng, Ä‘á»‹a lÃ½,... dáº«n tá»›i sá»± khÃ¡c nhau vá» kháº£ nÄƒng sá»‘ng sÃ³t vÃ  sinh sáº£n.\n\nKáº¿t cá»¥c lÃ  xuáº¥t hiá»‡n cÃ¡c cÃ¡ thá»ƒ Ä‘á»™t biáº¿n \"máº¡nh máº½ hÆ¡n\" hoáº·c Ä‘Ãºng lÃ  \"Ä‘áº·c biá»‡t hÆ¡n\" cÃ³ kháº£ nÄƒng tá»“n táº¡i khi xuáº¥t hiá»‡n sá»± thay Ä‘á»•i lá»›n, vÃ­ dá»¥ nhÆ° dÆ°á»›i Ä‘Ã¢y, do sá»± thay Ä‘á»•i vá» Ä‘á»‹a Ä‘iá»ƒm sá»‘ng, tá»« má»™t loáº¡i chim sáº» Ä‘Ã£ phÃ¡t triá»ƒn thÃ nh 3 phÃ¢n há» khÃ¡c nhau.\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/Natural_selection.jpg\" style=\"max-width: 80%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 1: VÃ­ dá»¥ vá» chá»n lá»c tá»± nhiÃªn\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://www.biologyonline.com/dictionary/natural-selection\">Link to Image</a>\n  </div>\n</div>\n```\n\nVáº­y lÃ­ thuyáº¿t nÃ y liÃªn quan gÃ¬ tá»›i váº¥n Ä‘á» tá»‘i Æ°u hÃ³a. ThÃ´ng thÆ°á»ng khi báº¡n muá»‘n tá»‘i Æ°u hÃ³a má»™t váº¥n Ä‘á» gÃ¬ Ä‘Ã³, báº¡n cáº§n xÃ¢y dá»±ng mÃ´ hÃ¬nh Ä‘á»‹nh lÆ°á»£ng nÃ³, vÃ­ dá»¥ nhÆ° dÆ°á»›i áº£nh nÃ y ta Ä‘ang cÃ³ mÃ´ hÃ¬nh [MILP](https://www.mathworks.com/help/optim/ug/mixed-integer-linear-programming-algorithms.html) nháº±m hoáº¡ch Ä‘á»‹nh tuyáº¿n Ä‘Æ°á»ng vÃ  tá»‘i Æ°u hÃ³a quÃ£ng Ä‘Æ°á»ng di chuyá»ƒn.\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/MILP.png\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 2: MÃ´ hÃ¬nh VRP\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://medium.com/@rihot_gusron/capacitated-vehicle-routing-problem-with-lingo-427c2d3bf724\">Link to Image</a>\n  </div>\n</div>\n```\n\nMá»¥c tiÃªu cá»§a hÃ m chÃ­nh lÃ  tÃ¬m ra giÃ¡ trá»‹ nhá» nháº¥t nghÄ©a lÃ  chi phÃ­ cho viá»‡c di chuyá»ƒn cá»§a xe lÃ  nhá» nháº¥t. Do Ä‘Ã³, báº¡n cÃ³ thá»ƒ hÃ¬nh dung ráº±ng **giÃ¡ trá»‹ nhá» nháº¥t** Ä‘Ã³ nhÆ° lÃ  cÃ¡c **cÃ¡ thá»ƒ Ä‘á»™t biáº¿n** cÃ³ kháº£ nÄƒng sá»‘ng sÃ³t cao nháº¥t trong quáº©n thá»ƒ.\n\nVÃ¬ váº­y thuáº­t toÃ¡n **Genetic** (GA) chÃ­nh lÃ  láº·p Ä‘i láº·p láº¡i sá»± chá»n lá»c tá»± nhiÃªn trong má»™t quáº§n thá»ƒ hoáº·c má»™t máº«u Ä‘á»ƒ Ä‘áº¿n cuá»‘i cÃ¹ng tÃ¬m ra cÃ¡ thá»ƒ vÆ°á»£t trá»™i nháº¥t.\n\n## CÃ¡ch hoáº¡t Ä‘á»™ng GA trong ML:\n\nTrong Machine Learning, GA nháº±m tÃ¬m ra Ä‘Ãºng cÃ¡c biáº¿n cáº§n thiáº¿t Ä‘á»ƒ xÃ¢y dá»±ng mÃ´ hÃ¬nh tá»‘t nháº¥t. Gá»‰a sá»­ chÃºng ta cÃ³ 2 mÃ´ hÃ¬nh lÃ :\n\n-   MÃ´ hÃ¬nh 1: gá»“m cÃ¡c biáº¿n A,C,D.\n-   MÃ´ hÃ¬nh 2: gá»“m biáº¿n A,B,E.\n\nVáº­y mÃ´ hÃ¬nh nÃ o má»›i lÃ  tá»‘t nháº¥t cho mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n ? ChÃºng ta chÆ°a biáº¿t Ä‘Æ°á»£c vÃ  chá»‰ cÃ³ thá»ƒ so sÃ¡nh nÃ³ thÃ´ng qua thuáº­t toÃ¡n Genetic.\n\nVá» quy trÃ¬nh, thuáº­t toÃ¡n Genetic sáº½ cÃ³ cÃ¡ch hoáº¡t Ä‘á»™ng nhÆ° dÆ°á»›i Ä‘Ã¢y. Quy trÃ¬nh nÃ y mÃ¬nh tham kháº£o cá»§a [@rohithgandhi2018].\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/Genetic_Algorithm.png\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 3: Thuáº­t toÃ¡n Genetic\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://medium.datadriveninvestor.com/genetic-algorithms-9f920939f7cc\">Link to Image</a>\n  </div>\n</div>\n```\n\nDiá»…n giáº£i cÃ¡ch hoáº¡t Ä‘á»™ng:\n\n-   BÆ°á»›c 1 (**Initialisation**): má»—i biáº¿n Ä‘Æ°á»£c xem lÃ  *Gene* vÃ  nhiá»u *Gene* gá»™p láº¡i thÃ nh má»™t mÃ´ hÃ¬nh hay gá»i lÃ  *Chromosome* vÃ  nhiá»u *Chromosome* sáº½ táº¡o thÃ nh má»™t quáº§n thá»ƒ (*Population*). Viá»‡c nÃ y giá»‘ng nhÆ° lÃ  báº¡n Ä‘ang trÃ¬nh bÃ y háº¿t cÃ¡c phÆ°Æ¡ng Ã¡n cÃ³ thá»ƒ sá»­ dá»¥ng.\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/Term.png\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 4: CÃ¡c thuáº­t ngá»¯ trong GA\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://www.doc.ic.ac.uk/research/technicalreports/2003/DTR03-4.pdf\">Link to Image</a>\n  </div>\n</div>\n```\n\n-   BÆ°á»›c 2 (**Fitness Function**): Báº¡n cáº§n xÃ¢y dá»±ng má»™t hÃ m má»¥c tiÃªu Ä‘á»ƒ tÃ­nh toÃ¡n giÃ¡ trá»‹ cho cÃ¡c mÃ´ hÃ¬nh á»Ÿ bÆ°á»›c 1.\n\n-   BÆ°á»›c 3 (**Selection**): Biáº¿n nÃ o cÃ³ giÃ¡ trá»‹ yáº¿u kÃ©m sáº½ bá»‹ loáº¡i vÃ  quÃ¡ trÃ¬nh tÃ­nh toÃ¡n sáº½ tiáº¿p tá»¥c á»Ÿ tháº¿ há»‡ cá»§a nÃ³ tiáº¿p theo. Diá»…n giáº£i Ä‘Æ¡n giáº£n hÆ¡n lÃ  chÃºng ta thá»­ má»™t cÃ¡ch khÃ¡c vÃ  cá»‘ gáº¯ng cáº£i thiá»‡n káº¿t quáº£.\n\n-   BÆ°á»›c 4 (**Crossover**): Táº¡o ra mÃ´ hÃ¬nh gá»“m cÃ¡c biáº¿n tá»‘t Ä‘Ã£ lá»±a chá»n á»Ÿ bÆ°á»›c 3. VÃ­ dá»¥ nhÆ° biáº¿n A, B lÃ  tá»‘t cho mÃ´ hÃ¬nh.\n\n-   BÆ°á»›c 5 (**Mutation**): Thay Ä‘á»•i mÃ´ hÃ¬nh Ä‘áº§u vÃ o Ä‘Ã£ bao gá»“m cÃ¡c biáº¿n á»Ÿ bÆ°á»›c 4 vÃ  báº¯t Ä‘áº§u láº¡i tá»« bÆ°á»›c 1. VÃ­ dá»¥ mÃ´ hÃ¬nh cáº§n chá»n gá»“m 5 biáº¿n vÃ  ta Ä‘Ã£ chá»n Ä‘Æ°á»£c biáº¿n A,B lÃ  tá»‘t. Do Ä‘Ã³, khi quay láº¡i bÆ°á»›c 1, ta chá»‰ cáº§n chá»n thÃªm 3 biáº¿n thay vÃ¬ 5 biáº¿n nhÆ° thÃ´ng thÆ°á»ng.\n\n# Thá»±c hÃ nh trong R:\n\nSau khi Ä‘Ã£ sÆ¡ lÆ°á»£c vá» thuáº­t toÃ¡n, bÃ¢y giá» ta sáº½ vÃ o pháº§n thá»±c hÃ nh trong R. Váº­y lÃ m sao Ä‘á»ƒ á»©ng dá»¥ng thuáº­t toÃ¡n Genetic trong R, mÃ¬nh Ä‘Ã£ kham kháº£o qua nhiá»u nguá»“n tÃ i liá»‡u vÃ  tá»•ng há»£p dÆ°á»›i Ä‘Ã¢y:\n\n**XÃ¢y dá»±ng hÃ m má»¥c tiÃªu**: hÃ m má»¥c tiÃªu lÃ  bÆ°á»›c quan trá»ng nháº¥t trong thuáº­t toÃ¡n Genetic vÃ¬ nÃ³ lÃ  cÆ¡ sá»Ÿ Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ vÃ  lá»±a chá»n cÃ¡ thá»ƒ vÆ°á»£t trá»™i nháº¥t. VÃ  hÃ m má»¥c tiÃªu sáº½ luÃ´n khÃ¡c nhau tÃ¹y vÃ o váº¥n Ä‘á» mÃ  ta Ä‘áº·t ra. Giáº£ sá»­ chÃºng ta muá»‘n tá»‘i Æ°u chi phÃ­ thÃ¬ nÃ³ lÃ  hÃ m Min, cÃ²n ta muá»‘n tá»‘i Ä‘a lá»£i nhuáº­n thÃ¬ nÃ³ sáº½ lÃ  hÃ m Max.\n\nVáº­y hÃ m má»¥c tiÃªu cá»§a bÃ i toÃ¡n trÃªn trong R, báº¡n cÃ³ thá»ƒ tham kháº£o pháº§n code bÃªn dÆ°á»›i mÃ¬nh:\n\n::: callout-important\n### Type of fitness function\n\nÄá»‘i sá»‘ `type` trong hÃ m cÃ³ 3 giÃ¡ trá»‹:\n\n-   `\"binary\"`: Ä‘áº¡i diá»‡n cho biáº¿n quyáº¿t Ä‘á»‹nh dáº¡ng phÃ¢n loáº¡i, vÃ­ dá»¥: cÃ³/khÃ´ng\n-   `\"real-valued\"`: dÃ¹ng dá»ƒ tá»‘i Æ°u cho cÃ¡c biáº¿n quyáº¿t Ä‘á»‹nh lÃ  dáº¡ng sá»‘ thá»±c, sá»‘ tá»± nhiÃªn.\n-   `\"permutation\"`: cho cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n viá»‡c sáº¯p xáº¿p láº¡i cÃ¡c biáº¿n thÃ nh danh sÃ¡ch, vÃ­ dá»¥: thang Ä‘o Likert.\n:::\n\nChi tiáº¿t vá» hÃ m `ga()`, báº¡n cÃ³ thá»ƒ tham kháº£o tÃ i liá»‡u cá»§a [@lucascrucca2013].\n\n## Thuáº­t toÃ¡n Genetic:\n\nVáº­y bÃ¢y giá» chÃºng ta sáº½ xá»­ lÃ­ bÃ i toÃ¡n trÃªn theo thuáº­t toÃ¡n **Genetic**\n\nGá»‰a sá»­ chÃºng ta cÃ³ bÃ i toÃ¡n vá» váº­n chuyá»ƒn hÃ ng tá»« nhÃ  kho Ä‘á»ƒ thá»a mÃ£n nhu cáº§u á»Ÿ cÃ¡c Ä‘iá»ƒm **DC (Distribution center)**. VÃ  cÃ´ng thá»©c Ä‘á»ƒ tÃ­nh toÃ¡n Ä‘Æ°á»£c chi phÃ­ lÃ :\n\nHÃ m chi phÃ­ tá»•ng thá»ƒ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh nhÆ° sau:\n\n$$\nTC = \\sum_{i=1}^{m} \\left( D_{ij} \\times \\frac{P}{F} \\times 0.4 + LC_i \\right) \\times Q_j\n$$\n\nTrong bÃ i toÃ¡n nÃ y, báº¡n sáº½ cáº§n dá»¯ liá»‡u Ä‘á»ƒ tÃ­nh toÃ¡n 2 thÃ´ng sá»‘ lÃ : **PhÃ­ bá»‘c xáº¿p (Loading cost)** vÃ  **Chi phÃ­ váº­n chuyá»ƒn (Transportation cost)**.\n\nNáº¿u trong cÃ´ng viá»‡c thÆ°á»ng ngÃ y á»Ÿ cÃ´ng ty, chÃºng ta sáº½ cáº§n láº¥y dá»¯ liá»‡u tá»« **Data warehouse** báº±ng SQL hoáº·c cÃ¡c pháº§n má»m **Business Intelligence** khÃ¡c. á» Ä‘Ã¢y, nháº±m má»¥c Ä‘Ã­ch há»c táº­p, mÃ¬nh Ä‘Ã£ táº¡o ra code á»Ÿ phÃ­a dÆ°á»›i Ä‘á»ƒ xÃ¢y dá»±ng dá»¯ liá»‡u cho cÃ¡c báº¡n luyá»‡n táº­p.\n\n```{r}\n# Create a data frame for loading costs\nloading_costs <- data.frame(\n  Warehouse = rep(paste(\"WH\", 1:5), each = 4),\n  ID = rep(1:5, times = 4),\n  Weight_Category = rep(c(\"< 2 tons\", \"2 to 5 tons\", \"5 to 10 tons\", \"> 10 tons\"), times = 5),\n  Has_Machine = rep(c(\"Yes\", \"No\", \"Yes\", \"No\", \"No\"), each = 4),\n  Loading_Cost = c(80, 100, 120, 160,  # Warehouse 1 (with machine)\n                   110, 150, 180, 210,  # Warehouse 2 (without machine)\n                   85, 105, 125, 140,  # Warehouse 3 (with machine)\n                   150, 170, 190, 210,  # Warehouse 4 (without machine)\n                   140, 165, 185, 215)   # Warehouse 5 (without machine)\n)\n\n# Set seed for reproducibility\nset.seed(123)\n\n# Define parameters\nweight_categories <- c(\"< 1.5\", \"1.5 to 2.5\", \"2.5 to 5\", \"5 to 10\", \"> 10\")\n# Create the data frame\nloading_costs <- data.frame(\n  Warehouse = rep(1:5, each = 15),  # 5 warehouses, 15 rows each\n  DC = rep(rep(1:3, each = 5), times = 5),  # Repeat 1, 2, 3 for each warehouse\n  Weight_Category = rep(weight_categories, times = 15),  # Repeat categories for 15 rows\n  Loading_Cost = round(runif(75, 5, 150), 2),\n  Has_Machine = sample(c(\"Yes\", \"No\"), 75, replace = TRUE)\n)\n\n# Define warehouses with coordinates (latitude, longitude)\nwarehouses <- data.frame(\n  ID = 1:5,\n  Latitude = c(21.0285, 16.0545, 10.7769, 14.0583, 19.8060), # Example latitudes (Hanoi, HCMC, Da Nang, etc.)\n  Longitude = c(105.804, 108.2022, 106.6957, 108.2772, 105.7460) # Example longitudes\n)\n\n# Define distribution centers data in Vietnam (example coordinates)\ndistribution_centers <- data.frame(\n  ID = 1:3,\n  Demand = c(90, 30, 150),\n  Latitude = c(17.974855, 11.7769, 15.122327), # Example latitudes (Hanoi, Da Nang, HCMC)\n  Longitude = c(102.630867, 106.6957, 108.799357) # Example longitudes\n)\n```\n\nNáº¿u báº¡n tá»«ng gáº·p khÃ³ khÄƒn trong viá»‡c pháº£i Ä‘á»‘i máº·t vá»›i cáº£ Ä‘á»‘ng dá»¯ liá»‡u tá»« há»‡ thá»‘ng vÃ  chÆ°a biáº¿t láº¥y dá»¯ liá»‡u nÃ o Ä‘á»ƒ phÃ¢n tÃ­ch hoáº·c gá»™p báº£ng nÃ o qua báº£ng nÃ o thÃ¬ lá»i khuyÃªn cá»§a mÃ¬nh lÃ  hÃ£y váº½ báº£ng **Entity relation diagram (ERD)**.\n\n**ERD** lÃ  má»™t cÃ´ng cá»¥ trá»±c quan dÃ¹ng Ä‘á»ƒ mÃ´ táº£ cáº¥u trÃºc dá»¯ liá»‡u trong cÆ¡ sá»Ÿ dá»¯ liá»‡u. ERD thá»ƒ hiá»‡n cÃ¡c thá»±c thá»ƒ (*entities*), thuá»™c tÃ­nh (*attributes*), vÃ  cÃ¡c má»‘i quan há»‡ (*relationships*) giá»¯a chÃºng. CÃ¡c thá»±c thá»ƒ thÆ°á»ng Ä‘Æ°á»£c biá»ƒu diá»…n dÆ°á»›i dáº¡ng hÃ¬nh chá»¯ nháº­t, thuá»™c tÃ­nh dÆ°á»›i dáº¡ng hÃ¬nh ellips, vÃ  má»‘i quan há»‡ báº±ng hÃ¬nh thoi hoáº·c Ä‘Æ°á»ng ná»‘i. ERD giÃºp láº­p káº¿ hoáº¡ch cho thiáº¿t káº¿ cÆ¡ sá»Ÿ dá»¯ liá»‡u, Ä‘áº£m báº£o ráº±ng cÃ¡c yáº¿u tá»‘ dá»¯ liá»‡u vÃ  quan há»‡ giá»¯a chÃºng Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh rÃµ rÃ ng, táº¡o ná»n táº£ng cho viá»‡c phÃ¡t triá»ƒn vÃ  quáº£n lÃ½ dá»¯ liá»‡u hiá»‡u quáº£.\n\nNhÆ° biá»ƒu Ä‘á»“ dÆ°á»›i Ä‘Ã¢y, mÃ¬nh Ä‘ang cÃ³ 3 báº£ng gá»“m:\n\n-   Báº£ng thÃ´ng tin chi tiáº¿t vá» DC.\n\n-   Báº£ng thÃ´ng tin chi tiáº¿t vá» WH.\n\n-   Báº£ng giÃ¡ vá» loading cost vÃ  transportation cost tá»« WH Ä‘áº¿n DC.\n\nVÃ  cÃ¡c báº¡n cÃ³ thá»ƒ dá»… dÃ ng hÃ¬nh dung cÃ¡c má»‘i quan há»‡ thÃ´ng qua báº£ng **Entity relation diagram (ERD)** dÆ°á»›i Ä‘Ã¢y:\n\n```{r}\n#| echo: false\n#| fig-subcap: \"Biá»ƒu Ä‘á»“ 1: EDR model\"\nlibrary(datamodelr)\n# Create the data model from your data frames\ndm1 <- dm_from_data_frames(list(\n  Warehouses = warehouses,\n  Loading_Costs = loading_costs,\n  Distribution_Centers = distribution_centers\n)) |>\n  dm_set_key(\"Warehouses\", \"ID\") |>\n  dm_set_key(\"Loading_Costs\", c(\"Warehouse\", \"DC\")) |>\n  dm_set_key(\"Distribution_Centers\", \"ID\") |>\n  dm_add_references(\n    Loading_Costs$Warehouse == Warehouses$ID,  # Correct reference\n    Loading_Costs$DC == Distribution_Centers$ID  # Assuming this is the correct reference\n  )\n\n# Create and render the ERD\ndm_create_graph(dm1, rankdir = \"LR\", columnArrows = TRUE) |>\n  dm_render_graph()\n```\n\n::: callout-tip\n### Táº£i package datamodelr:\n\nMÃ¬nh táº¡o biá»ƒu Ä‘á»“ nÃ y báº±ng thÆ° viá»‡n `datamodelr`. Báº¡n cÃ³ thá»ƒ táº£i báº±ng cÃº phÃ¡p: `devtools::install_github(\"bergant/datamodelr\")`\n:::\n\n### Dá»¯ liá»‡u Ä‘áº§u vÃ o:\n\nNhÆ° váº­y, dá»±a vÃ o Ä‘Ã³, ta sáº½ tÃ­nh toÃ¡n Ä‘Æ°á»£c 2 *matrix* vá» chi phÃ­:\n\n-   Báº£ng giÃ¡ loading á»Ÿ cÃ¡c kho. (HÃ¬nh bÃªn trÃ¡i)\n\n-   Báº£ng chi phÃ­ váº­n chuyá»ƒn tá»« tá»«ng WH Ä‘áº¿n cÃ¡c DCs. (HÃ¬nh bÃªn pháº£i)\n\n```{r}\n#| warning: false\n#| message: false\n## Calculate the transportation cost:\n# Haversine distance function\nhaversine <- function(lat1, lon1, lat2, lon2) {\n  R <- 6371 # Radius of Earth in kilometers\n  dlat <- (lat2 - lat1) * pi / 180\n  dlon <- (lon2 - lon1) * pi / 180\n  a <- sin(dlat / 2) * sin(dlat / 2) +\n       cos(lat1 * pi / 180) * cos(lat2 * pi / 180) * \n       sin(dlon / 2) * sin(dlon / 2)\n  c <- 2 * atan2(sqrt(a), sqrt(1 - a))\n  R * c # Distance in kilometers\n}\n\n# Calculate distance matrix based on coordinates\ndistance_matrix <- matrix(0, nrow = nrow(warehouses), ncol = nrow(distribution_centers))\n\nfor (i in 1:nrow(warehouses)) {\n  for (j in 1:nrow(distribution_centers)) {\n    distance_matrix[i, j] <- haversine(\n      warehouses$Latitude[i], warehouses$Longitude[i],\n      distribution_centers$Latitude[j], distribution_centers$Longitude[j]\n    )\n  }\n}\n\n# Define the fuel price (example value)\nfuel_price <- 20 # Fuel price per kilometer\n\n# Calculate transportation costs\ntransportation_costs <- distance_matrix * fuel_price * 0.4\n\n## Calculate the loading cost:\nweights_per_good <- 0.1\n\nmean_loading_cost<-loading_costs |> \n  group_by(DC, Warehouse) |> \n  summarise(mean = mean(Loading_Cost,na.rm = TRUE)/1000/weights_per_good) |> # Assumes weighted of goods is 0.1kg \n  ungroup()\n\nlibrary(data.table)\n# Reshape the data frame to a wide format\nmean_cost_matrix <- reshape2::dcast(mean_loading_cost,\n                          Warehouse ~ DC, \n                          value.var = \"mean\")\n\n# Convert the data frame to a matrix and remove the Warehouse column\nloading_costs_per_dc <- as.matrix(mean_cost_matrix[,-1])\n\n# Set row names as the warehouse names\nrownames(loading_costs_per_dc) <- mean_loading_cost$Warehouse[!duplicated(mean_loading_cost$Warehouse)]\n```\n\n\n::: {.panel-tabset}\n\n#### Báº£ng chi phÃ­ bá»‘c xáº¿p\n\n```{r}\n#| warning: false\n#| message: false\n#| echo: false\n#| fig-cap: [\"Biá»ƒu Ä‘á»“ 2: Heatmap cho báº£ng chi phÃ­ bá»‘c xáº¿p\"]\n# Code táº¡o hai biá»ƒu Ä‘á»“\n\nlibrary(ggplot2)\n\n# Convert the distance matrix to a data frame\ndistance_df <- reshape2::melt(transportation_costs)\ncolnames(distance_df) <- c(\"Warehouse\", \"Distribution_Center\", \"Transportation_Cost\")\n\n# Plot the distance matrix with updated colors\nggplot(distance_df, aes(x = Warehouse, \n                        y = Distribution_Center, \n                        fill = Transportation_Cost)) +\n  geom_tile(color = \"white\", linewidth = 0.5) +  # Add borders to tiles\n  geom_text(aes(label = scales::comma(Transportation_Cost, accuracy = 1)), \n            color = ifelse(distance_df$Transportation_Cost > \n                           max(distance_df$Transportation_Cost)/2, \"white\", \"black\"),\n            size = 3.5) +  # Adaptive text color\n  scale_fill_gradient2(\n    low = \"#f7fbff\", \n    mid = \"#6baed6\", \n    high = \"#08519c\",\n    midpoint = median(distance_df$Transportation_Cost),\n    name = \"Cost (VNÄ)\",\n    labels = scales::comma\n  ) +\n  theme_minimal() +\n  labs(\n    title = \"Transportation Costs Between Facilities\",\n    subtitle = \"Costs shown in Vietnamese Dong (VNÄ)\",\n    x = \"Warehouse\",\n    y = \"Distribution Center\"\n  ) +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1, face = \"bold\", size = 12),\n    axis.text.y = element_text(face = \"bold\", size = 12),\n    axis.title.x = element_text(size = 14, face = \"bold\", margin = margin(t = 15)),\n    axis.title.y = element_text(size = 14, face = \"bold\", margin = margin(r = 15)),\n    plot.title = element_text(face = \"bold\", size = 16),\n    plot.subtitle = element_text(size = 12, color = \"gray30\"),\n    panel.grid = element_blank(),  # Remove grid lines\n    legend.position = \"right\"\n  )\n\n```\n\n\n#### Báº£ng giÃ¡ váº­n chuyá»ƒn:\n\n```{r}\n#| warning: false\n#| message: false\n#| echo: false\n#| fig-cap: [\"Biá»ƒu Ä‘á»“ 3: Báº£ng giÃ¡ váº­n chuyá»ƒn tá»« WH Ä‘áº¿n DC\"]\n# Convert the transportation costs matrix to a data frame\nlibrary(gt)\nlibrary(gtExtras)\n# Create a gt table\nm<-loading_costs |>\n  mutate(Loading_Cost = Loading_Cost * 1000,\n         DC = paste(\"DC\",DC),\n         Warehouse = paste(\"WH\",Warehouse)) # Convert to currency\n  \nhead(m[order(-m$Loading_Cost),]) |> \n  gt() |>\n  fmt_currency(\n    columns = Loading_Cost,\n    currency = \"VND\",\n    decimals = 0,\n    use_seps = TRUE\n  ) |>\n  tab_header(\n    title = md(\"**Loading Costs by weight category in each warehouses**\"),\n    subtitle = md(\"Table just contains **expected loading cost**\")\n  ) |>  \n  opt_align_table_header(align = \"center\") |> \n  cols_label(\n    Loading_Cost = \"Loading Cost (VNÄ)\",\n    Weight_Category = \"Weight Category\",\n    Has_Machine = \"Has Machine\",\n    DC = \"Distribution Center\"\n  ) |> \n  data_color(method = \"numeric\",\n             palette = \"viridis\",\n             reverse = TRUE) |> \n  gt_theme_pff() |> \n  tab_style(style = list(cell_text(align = \"center\")),\n            locations = cells_body(columns = everything())) |>\n  tab_style(\n    style = list(\n      cell_text(align = \"center\")\n    ),\n    locations = list(\n      cells_column_labels(everything())\n    )\n  ) |> \n  tab_source_note(source = md(\"*Source: package gt in R*\")) |> \n  tab_style(\n    style = \"font-weight: bold\",\n    locations = cells_body(Weight_Category)\n  )\n  \n```\n\n:::\n\n### XÃ¢y dá»±ng hÃ m má»¥c tiÃªu:\n\nSau khi Ä‘Ã£ cÃ³ Ä‘á»§ dá»¯ liá»‡u, báº¡n sáº½ báº¯t Ä‘áº§u viáº¿t hÃ m má»¥c tiÃªu vÃ  dÃ¹ng thuáº­t toÃ¡n GA Ä‘á»ƒ tÃ¬m ra giÃ¡ trá»‹ tá»‘i Æ°u nháº¥t.\n\nTrong hÃ m `ga` tá»« gÃ³i **GA** trong R, cÃ³ má»™t sá»‘ Ä‘á»‘i sá»‘ quan trá»ng cho phÃ©p báº¡n tÃ¹y chá»‰nh thuáº­t toÃ¡n di truyá»n. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t cÃ¡i nhÃ¬n tá»•ng quan vá» má»™t sá»‘ Ä‘á»‘i sá»‘ quan trá»ng:\n\n-   **type**: Chá»‰ Ä‘á»‹nh loáº¡i tá»‘i Æ°u hÃ³a (vÃ­ dá»¥: `\"real-valued\"`, `\"binary\"` hoáº·c `\"permutation\"`).\n\n-   **fitness**: HÃ m Ä‘Ã¡nh giÃ¡ Ä‘á»™ phÃ¹ há»£p; nÃ³ nÃªn nháº­n má»™t vector tham sá»‘ lÃ m Ä‘áº§u vÃ o vÃ  tráº£ vá» má»™t giÃ¡ trá»‹ sá»‘.\n\n-   **lower** vÃ  **upper**: Äá»‹nh nghÄ©a giá»›i háº¡n cho cÃ¡c biáº¿n náº¿u báº¡n Ä‘ang tá»‘i Æ°u hÃ³a trong khÃ´ng gian liÃªn tá»¥c (dÃ¹ng cho cÃ¡c loáº¡i giÃ¡ trá»‹ thá»±c).\n\n-   **popSize**: Thiáº¿t láº­p kÃ­ch thÆ°á»›c quáº§n thá»ƒ cho má»—i tháº¿ há»‡.\n\n-   **maxiter**: Chá»‰ Ä‘á»‹nh sá»‘ tháº¿ há»‡ tá»‘i Ä‘a Ä‘á»ƒ cháº¡y thuáº­t toÃ¡n.\n\n-   **run**: Chá»‰ Ä‘á»‹nh sá»‘ tháº¿ há»‡ Ä‘á»ƒ cháº¡y thuáº­t toÃ¡n mÃ  khÃ´ng cÃ³ sá»± cáº£i thiá»‡n trÆ°á»›c khi dá»«ng láº¡i.\n\n-   **pmutation**: XÃ¡c suáº¥t xáº£y ra Ä‘á»™t biáº¿n trong quáº§n thá»ƒ.\n\n-   **elitism**: XÃ¡c Ä‘á»‹nh xem cÃ¡c cÃ¡ thá»ƒ tá»‘t nháº¥t cÃ³ nÃªn Ä‘Æ°á»£c giá»¯ láº¡i trong tháº¿ há»‡ tiáº¿p theo hay khÃ´ng.\n\nNhá»¯ng Ä‘á»‘i sá»‘ nÃ y giÃºp Ä‘iá»u chá»‰nh thuáº­t toÃ¡n di truyá»n cho cÃ¡c nhu cáº§u tá»‘i Æ°u hÃ³a cá»¥ thá»ƒ cá»§a báº¡n, cho phÃ©p hiá»‡u suáº¥t tá»‘t hÆ¡n vÃ  há»™i tá»¥ vá» cÃ¡c giáº£i phÃ¡p tá»‘i Æ°u.\n\nNgoÃ i ra, cÃ²n cÃ³ cÃ¡c lÆ°u Ã½ cho báº¡n khi sá»­ dá»¥ng R nhÆ° sau:\n\n::: callout-caution\n##### LÆ°u Ã½ khi dÃ¹ng hÃ m ga():\n\nHÃ m `ga()` pháº£i cÃ³ Ã­t nháº¥t 2 Ä‘á»‘i sá»‘ lÃ  `type` vÃ  `fitness thÃ¬ R má»›i cháº¡y Ä‘Æ°á»£c.`\n\n-   RiÃªng khi type = \"binary\" thÃ¬ cáº§n thÃªm Ä‘á»‘i sá»‘ `nBits.`\n\n-   CÃ²n khi `type = \"real-valued\"/\"permutation\"` thÃ¬ cáº§n thÃªm Ä‘á»‘i sá»‘ `min` vÃ  `max`.\n:::\n\n```{r}\n#| message: false\n#| warning: false\n#| output: false\n# Load necessary library\nlibrary(GA)\ndemand<-c(distribution_centers$Demand)\n\n# Define the objective function\nobjective_function <- function(quantities) {\n    quantities_matrix <- matrix(quantities, \n                                nrow = 5, \n                                ncol = 3, \n                                byrow = TRUE)\n    \n    # Calculate total loading costs\n    loading_costs <- rowSums(quantities_matrix) * loading_costs_per_dc  # Total loading costs for each DC\n    # Calculate total transportation costs\n    transportation_costs <- sum(quantities_matrix * transportation_costs)\n    \n    # Combine both costs\n    total_cost <- sum(loading_costs) + transportation_costs\n    \n    # Check if demands are met\n    if (any(colSums(quantities_matrix) < demand)) {\n        return(Inf)  # Penalize if demands are not met\n    }\n    \n    return(total_cost)\n}\n\n# Set up the Genetic Algorithm\nnum_vars <- 5 * 3  # 5 warehouses, 3 distribution centers\nga_result <- ga(\n    type = \"real-valued\",\n    fitness = function(x) -objective_function(x),  # Negate for minimization\n    lower = rep(0, num_vars),  # Minimum quantity\n    upper = rep(100, num_vars),  # Maximum quantity (adjust as needed)\n    popSize = 50,\n    maxiter = 100,\n    run = 10,\n    monitor = TRUE\n)\n```\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n# Print the summary of the GA result\nplot(ga_result)\n# Assuming ga_result@solution contains optimal quantities\nga_result_solution <- c(ga_result@solution)\n\n# Reshape the solution into a matrix (5 warehouses x 3 DCs)\noptimal_quantities <- matrix(ga_result@solution,\n                             nrow = 5, \n                             ncol = 3, \n                             byrow = TRUE)\n\n# Convert the matrix to a data frame\nweights<-optimal_quantities* weights_per_good\n\nrownames(weights) <- 1:5\ncolnames(weights) <- 1:3\n\nlibrary(reshape2)\nreal_weighted <- melt(weights)\n\n# Rename the columns\ncolnames(real_weighted) <- c(\"Warehouse\", \"DC\", \"Total_Weight\")\n\n# Perform left join\nresult <- real_weighted |>\n  left_join(loading_costs, by = c(\"Warehouse\", \"DC\"))\n\nresult <-result |> \n  mutate(Price = case_when(\n    Total_Weight < 1.5 ~ \"< 1.5\",\n    Total_Weight <2.5 ~ \"1.5 to 2.5\",\n    Total_Weight < 5 ~ \"2.5 to 5\",\n    Total_Weight < 10 ~ \"5 to 10\",\n    Total_Weight >= 10 ~ \"> 10\",\n      is.na(Total_Weight) ~ NA_character_  # Handle NA explicitly if needed\n  ))\n  \nresult<-result |> \n  filter(Weight_Category == Price) |> \n  select(-Price)\n\n# Join with tranportation cost table:\nrownames(transportation_costs) <- 1:5\ncolnames(transportation_costs) <- 1:3\n\ntransport<-melt(transportation_costs)\n\n# Rename the columns\ncolnames(transport) <- c(\"Warehouse\", \"DC\", \"Transport_cost\")\n\n\nresult<-left_join(result,\n                  transport,\n                  by=c(\"Warehouse\", \"DC\"))\n\n# Adjust:\n\nresult<-result |> \n      mutate(Loading_Cost = Loading_Cost*1000,\n             Transport_cost = Transport_cost*1000,\n             DC = paste(\"DC\",DC),\n             Warehouse = paste(\"WH\",Warehouse)) \n\n# Reorder cols in table:\nresult<-result[,c(\"Warehouse\",\n                 \"DC\",\n                 \"Has_Machine\",\n                 \"Total_Weight\",\n                 \"Weight_Category\",\n                 \"Loading_Cost\",\n                 \"Transport_cost\")]\n```\n\nKáº¿t quáº£ tá»‘i Æ°u sáº½ Ä‘Æ°á»£c trÃ¬nh bÃ y á»Ÿ báº£ng nÃ y (hÆ¡i mÃ u mÃ¨ 1 tÃ­!!!)\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\nlibrary(gt)\nlibrary(dplyr)\nlibrary(scales)\n\n# Add Total_Cost column and Has_Machine_Icon\nresult <- result |> \n  mutate(\n    Total_Cost = Loading_Cost + Transport_cost,\n    Has_Machine_Icon = ifelse(Has_Machine == \"Yes\", \"âœ…\", \"âŒ\")\n  ) |> \n  select(-Has_Machine)\n\n# Find the row with highest total cost\nmax_total_cost <- max(result$Total_Cost, na.rm = TRUE)\n\n# Build enhanced GT table\nresult |>\n  gt() |>\n  tab_header(\n    title = html(\"<b>ğŸ“¦ Warehouse Shipment Summary</b>\"),\n    subtitle = md(\"Cost Breakdown & Machine Availability\")\n  ) |>\n  fmt_currency(\n    columns = c(Loading_Cost, Transport_cost, Total_Cost),\n    currency = \"USD\"\n  ) |>\n  fmt_number(\n    columns = Total_Weight,\n    decimals = 2\n  ) |>\n  data_color(\n    columns = Total_Weight,\n    colors = col_numeric(\n      palette = c(\"lightblue\", \"blue\"),\n      domain = NULL\n    )\n  ) |>\n  data_color(\n    columns = Loading_Cost,\n    colors = col_numeric(\n      palette = c(\"lightyellow\", \"orange\"),\n      domain = NULL\n    )\n  ) |>\n  data_color(\n    columns = Transport_cost,\n    colors = col_numeric(\n      palette = c(\"lightpink\", \"deeppink\"),\n      domain = NULL\n    )\n  ) |>\n  data_color(\n    columns = Total_Cost,\n    colors = col_numeric(\n      palette = c(\"lightgreen\", \"forestgreen\"),\n      domain = NULL\n    )\n  ) |>\n  tab_style(\n    style = cell_text(weight = \"bold\"),\n    locations = cells_body(\n      columns = vars(Total_Cost),\n      rows = Total_Cost == max_total_cost\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"lightgray\"),\n    locations = cells_body(\n      columns = vars(Has_Machine_Icon),\n      rows = Has_Machine_Icon == \"âœ…\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#f5e1f7\"),\n    locations = cells_body(\n      columns = vars(Has_Machine_Icon),\n      rows = Has_Machine_Icon == \"âŒ\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#fdf5e6\"),\n    locations = cells_body(\n      columns = vars(Weight_Category),\n      rows = Weight_Category == \"Light\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#ffe4b5\"),\n    locations = cells_body(\n      columns = vars(Weight_Category),\n      rows = Weight_Category == \"Medium\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#ffcccb\"),\n    locations = cells_body(\n      columns = vars(Weight_Category),\n      rows = Weight_Category == \"Heavy\"\n    )\n  ) |> \n  cols_label(\n  Warehouse = \"ğŸ¢ Warehouse\",\n  DC = \"ğŸ¬ Distribution Center\",\n  Has_Machine_Icon = \"ğŸ›  Machine\",\n  Total_Weight = \"ğŸ“¦ Total Weight (kg)\",\n  Weight_Category = \"âš–ï¸ Weight Category\",\n  Loading_Cost = \"ğŸ’¼ Loading Cost\",\n  Transport_cost = \"ğŸšš Transport Cost\",\n  Total_Cost = \"ğŸ’° Total Cost\"\n) |>\ntab_style(\n  style = cell_text(weight = \"bold\"),\n  locations = cells_column_labels(columns = everything())\n) |> \n  opt_row_striping()\n```\n\n# BÃ¡o cÃ¡o:\n\nVÃ  cuá»‘i cÃ¹ng, sau khi cÃ³ káº¿t quáº£, mÃ¬nh sáº½ dÃ¹ng cÃ¡c thÆ° viá»‡n gá»“m: **Leaflet**, **gt**, vÃ  **biá»ƒu Ä‘á»“ Sankey** phá»¥c vá»¥ nhá»¯ng má»¥c Ä‘Ã­ch khÃ¡c nhau cho trá»±c quan hÃ³a dá»¯ liá»‡u.\n\n1.  **Leaflet**: ÄÃ¢y lÃ  má»™t thÆ° viá»‡n máº¡nh máº½ Ä‘á»ƒ táº¡o báº£n Ä‘á»“ tÆ°Æ¡ng tÃ¡c. NÃ³ cho phÃ©p ngÆ°á»i dÃ¹ng dá»… dÃ ng thÃªm cÃ¡c lá»›p, Ä‘iá»ƒm Ä‘Ã¡nh dáº¥u vÃ  pop-up, ráº¥t lÃ½ tÆ°á»Ÿng Ä‘á»ƒ trá»±c quan hÃ³a dá»¯ liá»‡u Ä‘á»‹a lÃ½. Leaflet Ä‘áº·c biá»‡t há»¯u Ã­ch Ä‘á»ƒ hiá»ƒn thá»‹ cÃ¡c dá»¯ liá»‡u nhÆ° vá»‹ trÃ­, lá»™ trÃ¬nh, hoáº·c phÃ¢n bá»‘ khÃ´ng gian.\n\n2.  **gt**: GÃ³i **gt** Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ táº¡o ra cÃ¡c báº£ng cháº¥t lÆ°á»£ng cao trong R. NÃ³ cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘á»‹nh dáº¡ng vÃ  táº¡o kiá»ƒu cho báº£ng má»™t cÃ¡ch dá»… dÃ ng, giÃºp chÃºng trá»Ÿ nÃªn háº¥p dáº«n vÃ  dá»… Ä‘á»c. gt há»— trá»£ cÃ¡c tÃ­nh nÄƒng nhÆ° Ä‘á»‹nh dáº¡ng tÃ¹y chá»‰nh, dÃ²ng tÃ³m táº¯t, vÃ  tháº­m chÃ­ thÃªm chÃº thÃ­ch, nÃ¢ng cao cÃ¡ch trÃ¬nh bÃ y dá»¯ liá»‡u trong bÃ¡o cÃ¡o.\n\n3.  **Biá»ƒu Ä‘á»“ Sankey**: Nhá»¯ng biá»ƒu Ä‘á»“ nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ trá»±c quan hÃ³a luá»“ng vÃ  má»‘i quan há»‡ giá»¯a cÃ¡c danh má»¥c khÃ¡c nhau. Trong R, gÃ³i **networkD3** hoáº·c **ggalluvial** cÃ³ thá»ƒ táº¡o ra biá»ƒu Ä‘á»“ Sankey, giÃºp hiá»ƒu cÃ¡ch cÃ¡c giÃ¡ trá»‹ di chuyá»ƒn giá»¯a cÃ¡c nÃºt, cháº³ng háº¡n nhÆ° theo dÃµi hÃ nh trÃ¬nh ngÆ°á»i dÃ¹ng hoáº·c hiá»ƒn thá»‹ phÃ¢n bá»• tÃ i nguyÃªn.\n\nÄá»ƒ káº¿t ná»‘i cÃ¡c biá»ƒu Ä‘á»“ láº¡i vá»›i nhau, ta thÆ°á»ng nghÄ© Ä‘áº¿n `Shiny` trong **R** nhÆ°ng vÃ¬ chÃºng ta Ä‘ang táº¡o website báº±ng **Quarto** nÃªn output cuá»‘i cÃ¹ng sáº½ lÃ  má»™t trang web tÄ©nh - *static website*. Do Ä‘Ã³, nÃ³ sáº½ khÃ´ng pháº£n há»“i vá»›i thÃ´ng tin Ä‘áº§u vÃ o cá»§a ngÆ°á»i dÃ¹ng hoáº·c cháº¡y báº¥t ká»³ mÃ£ R nÃ o. Báº¡n cÃ³ thá»ƒ hÃ¬nh dung giá»‘ng nhÆ° báº¡n Ä‘ang muá»‘n xem biá»ƒu Ä‘á»“ vá» doanh thu trong thÃ¡ng tiáº¿p theo trÃªn 1 biá»ƒu Ä‘á»“ trong Word - khÃ´ng thá»ƒ lÃ m Ä‘Æ°á»£c vÃ¬ nÃ³ thuá»™c dáº¡ng vÄƒn báº£n, báº¡n chá»‰ Ä‘á»c hoáº·c nhÃ¬n chá»© khÃ´ng tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c.\n\nTuy váº­y, sau má»™t thá»i gian tÃ¬m hiá»ƒu, mÃ¬nh cÅ©ng tÃ¬m Ä‘Æ°á»£c cÃ¡ch Ä‘á»ƒ nhÃºng **Shiny** vÃ o R Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn Quarto. Nguá»“n tÃ i liá»‡u báº¡n cÃ³ thá»ƒ kham kháº£o á»Ÿ trang nÃ y [r-shinylive-demo](https://github.com/coatless-quarto/r-shinylive-demo).\n\n::: {.callout-note}\n**Shinylive** lÃ  1 extension cá»§a Quarto vÃ  Ä‘Æ°á»£c kÃ­ch hoáº¡t báº±ng: \n```yaml\nfilter:\n  - quarto-ext/shinylive\n```\ncÃ¡c extension trong filter sáº½ áº£nh hÆ°á»Ÿng Ä‘áº¿n káº¿t quáº£ sau khi Quarto render xong. App Shiny chá»‰ xuáº¥t hiá»‡n sau Ä‘Ã³, nÃªn báº¡n cáº§n Ä‘á»£i thÃªm tÃ¹y theo Ä‘á»™ náº·ng cá»§a app.\n::: \n\n:::{.column-page}\n\n```{shinylive-r}\n#| viewerHeight: 1000\n#| standalone: true\n#| fig-cap: \"Biá»ƒu Ä‘á»“ 3: Dashboard vá» lá»‹ch trÃ¬nh váº­n chuyá»ƒn hÃ ng dá»± tÃ­nh\"\npacman::p_load(\n  leaflet,\n  dplyr,\n  networkD3,\n  shiny,\n  bslib,\n  DT,\n  htmltools\n)\n\n# Add value:\n# Convert GA solution to a matrix\n# Optimal quantities matrix\noptimal_quantities <- matrix(c(\n  43.306058, 10.87137, 13.26283,\n  15.524054, 30.42748, 48.86716,\n  7.599769, 44.93531, 27.46289,\n  18.556927, 17.60396, 41.85203,\n  16.305016, 13.15498, 21.79634\n), nrow = 5, ncol = 3, byrow = TRUE)\n\n# Warehouse data:\nwarehouses <- data.frame(\n  ID = 1:5,\n  Latitude = c(21.0285, 16.0545, 10.7769, 14.0583, 19.8060),\n  Longitude = c(105.8040, 108.2022, 106.6957, 108.2772, 105.7460),\n  District = c(\"Äá»‘ng Äa\", \"Háº£i ChÃ¢u\", \"Quáº­n 1\", \"Mang Yang\", \"ÄÃ´ng SÆ¡n\"),\n  Province = c(\"HÃ  Ná»™i\", \"ÄÃ  Náºµng\", \"Há»“ ChÃ­ Minh\", \"Gia Lai\", \"Thanh HÃ³a\"),\n  Address = c(\n    \"2RH3+9HX Äá»‘ng Äa, HÃ  Ná»™i, Viá»‡t Nam\",\n    \"3632+RV4 Háº£i ChÃ¢u, ÄÃ  Náºµng, Viá»‡t Nam\",\n    \"QMGW+Q74 Quáº­n 1, Há»“ ChÃ­ Minh, Viá»‡t Nam\",\n    \"375G+8VG Mang Yang, Gia Lai, Viá»‡t Nam\",\n    \"RP4W+99X ÄÃ´ng SÆ¡n, Thanh HÃ³a, Viá»‡t Nam\"\n  )\n)\n\n# Distribution center data:\ndistribution_centers <- data.frame(\n  ID = 1:3,\n  Latitude = c(17.97486, 11.77690, 15.12233),\n  Longitude = c(102.6309, 106.6957, 108.7994),\n  District = c(\"ViÃªng ChÄƒn\", \"Lá»™c Ninh\", \"Quáº£ng NgÃ£i\"),\n  Province = c(\"LÃ o\", \"BÃ¬nh PhÆ°á»›c\", \"Quáº£ng NgÃ£i\"),\n  Address = c(\n    \"XJFJ+W8X ViÃªng ChÄƒn, LÃ o\",\n    \"QMGW+Q74 Lá»™c Ninh, BÃ¬nh PhÆ°á»›c, Viá»‡t Nam\",\n    \"4QCX+WPQ Quáº£ng NgÃ£i, Viá»‡t Nam\"\n  )\n)\n\n# Create a data frame with the warehouse data\nresult <- data.frame(\n  Warehouse = c(\"WH 1\", \"WH 2\", \"WH 3\", \"WH 4\", \"WH 5\",\n                \"WH 1\", \"WH 2\", \"WH 3\", \"WH 4\", \"WH 5\",\n                \"WH 1\", \"WH 2\", \"WH 3\", \"WH 4\", \"WH 5\"),\n  DC = c(\"DC 1\", \"DC 1\", \"DC 1\", \"DC 1\", \"DC 1\",\n         \"DC 2\", \"DC 2\", \"DC 2\", \"DC 2\", \"DC 2\",\n         \"DC 3\", \"DC 3\", \"DC 3\", \"DC 3\", \"DC 3\"),\n  Has_Machine = c(\"Yes\", \"No\", \"No\", \"No\", \"No\",\n                  \"No\", \"No\", \"No\", \"No\", \"No\",\n                  \"No\", \"No\", \"No\", \"No\", \"No\"),\n  Total_Weight = c(4.3306058, 1.5524054, 0.7599769, 1.8556927, 1.6305016,\n                   1.0871366, 3.0427479, 4.4935308, 1.7603961, 1.3154977,\n                   1.3262832, 4.8867159, 2.7462887, 4.1852028, 2.1796338),\n  Weight_Category = c(\"2.5 to 5\", \"1.5 to 2.5\", \"< 1.5\", \"1.5 to 2.5\", \"1.5 to 2.5\",\n                      \"< 1.5\", \"2.5 to 5\", \"2.5 to 5\", \"1.5 to 2.5\", \"< 1.5\",\n                      \"< 1.5\", \"2.5 to 5\", \"2.5 to 5\", \"2.5 to 5\", \"1.5 to 2.5\"),\n  Loading_Cost = c(64300, 40680, 144640, 38790, 18750,\n                   11610, 97870, 36380, 69120, 70030,\n                   143740, 91150, 64990, 114230, 96240),\n  Transport_cost = c(3802097.2, 5037171.3, 7297102.2, 5952559.7, 3086494.5,\n                     8264855.3, 4021256.9, 889559.4, 2449208.3, 7188382.3,\n                     5831987.6, 974375.3, 4273915.6, 1047828.2, 4905804.6)\n)\n\n# Custom icon:\nwarehouse_icon <- makeIcon(\n  iconUrl = \"https://raw.githubusercontent.com/Loccx78vn/genetic-algorithm-method/refs/heads/main/img/warehouse_icon.png\",\n  iconWidth = 30,\n  iconHeight = 30\n)\n\ndc_icon <- makeIcon(\n  iconUrl = \"https://raw.githubusercontent.com/Loccx78vn/genetic-algorithm-method/refs/heads/main/img/distribution_center.png\",\n  iconWidth = 30,\n  iconHeight = 30\n)\n# Define a custom theme\nmy_theme <- bs_theme(\n  version = 5,\n  bootswatch = \"litera\",\n  primary = \"#3b5998\",\n  secondary = \"#5cb85c\",\n  success = \"#5cb85c\",\n  info = \"#5bc0de\",\n  warning = \"#f0ad4e\",\n  danger = \"#d9534f\"\n)\n\n# Define UI\nui <- page_fluid(\n  theme = my_theme,\n  \n  # Custom CSS for better visualization\n  tags$head(\n    tags$style(HTML(\"\n      .card-header {\n        background-color: #3b5998;\n        color: white;\n        font-weight: bold;\n      }\n      .nav-tabs .nav-link.active {\n        font-weight: bold;\n        color: #3b5998;\n        border-bottom: 2px solid #3b5998;\n      }\n      .nav-tabs .nav-link {\n        color: #6c757d;\n      }\n      .checkbox span {\n        font-weight: normal;\n      }\n      .checkbox input:checked + span {\n        font-weight: bold;\n        color: #3b5998;\n      }\n      .warehouse-selection {\n        border-left: 4px solid #3b5998;\n        padding-left: 10px;\n      }\n      .dataTables_wrapper {\n        padding: 10px;\n        border-radius: 5px;\n      }\n      .table thead th {\n        background-color: #e9ecef;\n      }\n      .leaflet-container {\n        border-radius: 8px;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      }\n      .sankey-container {\n        border: 1px solid #dee2e6;\n        border-radius: 8px;\n        padding: 10px;\n        background-color: #f8f9fa;\n      }\n      .summary-stats {\n        background-color: #f8f9fa;\n        border-radius: 5px;\n        padding: 10px;\n        margin-bottom: 15px;\n        border-left: 4px solid #3b5998;\n      }\n    \"))\n  ),\n  \n  # Page header - simplified\n  card(\n    card_header(\n      tags$div(\n        class = \"d-flex align-items-center\",\n        tags$img(\n          src = \"https://raw.githubusercontent.com/Loccx78vn/genetic-algorithm-method/refs/heads/main/img/supply-chain-management.png\", \n          height = \"30px\", \n          style = \"margin-right: 10px;\"\n        ),\n        h3(\"Warehouse Distribution Dashboard\", class = \"m-0\")\n      )\n    ),\n    card_body(\n      \"This dashboard shows the optimal distribution of goods from warehouses to distribution centers.\"\n    )\n  ),\n  \n  layout_sidebar(\n    sidebar = sidebar(\n      title = \"Controls\",\n      width = 300,\n      bg = \"#f8f9fa\",\n      class = \"warehouse-selection\",\n      \n      h4(\"Warehouse Selection\", class = \"mb-3 text-primary\"),\n      \n      p(\"Select one or more warehouses to view their distribution data on the map and in the charts.\"),\n      \n      checkboxGroupInput(\n        inputId = \"warehouse\", \n        label = NULL, \n        choices = setNames(\n          paste(\"Warehouse\", 1:5),\n          paste(\"Warehouse\", 1:5, \"-\", warehouses$District, \",\", warehouses$Province)\n        ),\n        selected = paste(\"Warehouse\", 1)\n      ),\n      \n      hr(),\n      \n      tags$div(\n        class = \"alert alert-info\",\n        icon(\"info-circle\"), \n        \"Click on the map markers for detailed location information.\"\n      )\n    ),\n    \n    # Main content - restructured to put summary above map\n    tabsetPanel(\n      tabPanel(\n        title = \"Interactive Map\", \n        icon = icon(\"map\"),\n        card(\n          full_screen = TRUE,\n          height = \"650px\", # Increased height\n          card_body(\n            # Summary stats placed above the map\n            tags$div(\n              class = \"summary-stats\",\n              uiOutput(\"summary_stats\")\n            ),\n            # Map with increased height\n            leafletOutput(\"map\", height = \"550px\") # Increased map height\n          )\n        )\n      ),\n      \n      tabPanel(\n        title = \"Cost Analysis\", \n        icon = icon(\"table\"),\n        card(\n          full_screen = TRUE,\n          height = \"650px\", # Increased to match\n          card_header(\"Cost Table\"),\n          DTOutput(\"cost_table\")\n        )\n      ),\n      \n      tabPanel(\n        title = \"Flow Diagram\", \n        icon = icon(\"diagram-project\"),\n        card(\n          full_screen = TRUE,\n          height = \"650px\", # Increased to match\n          card_header(\"Distribution Flow Diagram\"),\n          tags$div(\n            class = \"sankey-container\",\n            uiOutput(\"sankey_diagram\")\n          )\n        )\n      )\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output, session) {\n  \n  location <- reactive({\n    req(input$warehouse) \n    as.numeric(sub(\"Warehouse \", \"\", input$warehouse))\n  })\n  \n  # Create the leaflet map\n  output$map <- renderLeaflet({\n    req(location())\n    \n    # Color palette for routes\n    route_colors <- c(\"#FF5733\", \"#33A8FF\", \"#33FF57\", \"#D433FF\", \"#FFD133\")\n    \n    # Initialize the map\n    map <- leaflet() |>\n      addTiles() |>\n      addProviderTiles(providers$CartoDB.Positron) |>\n      addMarkers(data = warehouses |> filter(ID %in% location()), \n                 lat = ~Latitude, \n                 lng = ~Longitude, \n                 label = ~paste0(\"<strong> ID Warehouse: </strong> \", ID, \"<br/> \",\n                                 \"<strong> Province: </strong> \", Province, \"<br/> \",\n                                 \"<strong> District: </strong> \", District, \"<br/> \",\n                                 \"<strong> Address: </strong> \", Address, \"<br/> \") |> \n                   lapply(htmltools::HTML),\n                 icon = warehouse_icon) |>\n      addMarkers(data = distribution_centers, \n                 lat = ~Latitude, \n                 lng = ~Longitude, \n                 label = ~paste0(\"<strong> ID Distribution Center: </strong> \", ID, \"<br/> \",\n                                 \"<strong> Province: </strong> \", Province, \"<br/> \",\n                                 \"<strong> District: </strong> \", District, \"<br/> \",\n                                 \"<strong> Address: </strong> \", Address, \"<br/> \") |> \n                   lapply(htmltools::HTML),\n                 icon = dc_icon)\n    \n    qty_data <- optimal_quantities[location(), , drop = FALSE]  \n    \n    # Add routes based on the optimal quantities with different colors\n    route_colors <- c(\"#FF5733\", \"#33A8FF\", \"#33FF57\", \"#D433FF\", \"#FFD133\")\n    line_weights <- c(2, 3, 4, 5, 6)  # Variable line weights based on quantity\n    \n    # Add routes based on the optimal quantities\n    for (i in seq_along(location())) {\n      wh_id <- location()[i]\n      wh_idx <- which(warehouses$ID == wh_id)\n      color_idx <- (wh_id - 1) %% length(route_colors) + 1\n      \n      for (j in 1:ncol(qty_data)) {\n        if (qty_data[i, j] > 0) {\n          route_start <- warehouses[warehouses$ID == wh_id, c(\"Longitude\", \"Latitude\")]\n          route_end <- distribution_centers[distribution_centers$ID == j, c(\"Longitude\", \"Latitude\")]\n          \n          # Calculate line weight based on quantity (normalized)\n          weight_multiplier <- qty_data[i, j] / max(optimal_quantities) * 5\n          weight <- max(2, min(6, weight_multiplier + 2))  # Scale between 2-6\n          \n          map <- map |>\n            addPolylines(\n              lat = c(route_start$Latitude, route_end$Latitude),\n              lng = c(route_start$Longitude, route_end$Longitude),\n              color = route_colors[color_idx],\n              weight = weight,\n              opacity = 0.7,\n              label = paste0(\"Quantity: \", round(qty_data[i, j], 2)),\n              dashArray = \"5, 5\",\n              popup = paste0(\n                \"<strong>From:</strong> Warehouse \", wh_id,\n                \"<br><strong>To:</strong> Distribution Center \", j,\n                \"<br><strong>Quantity:</strong> \", round(qty_data[i, j], 2)\n              )\n            )\n        }\n      }\n    }\n    \n    map  # Return the modified map\n  })\n  \n  # Render the cost table\n  output$cost_table <- renderDT({\n    req(location())\n    \n    cost_data <- result |> \n      filter(Warehouse %in% paste(\"WH\", location())) |> \n      select(c(Warehouse, DC, Loading_Cost, Transport_cost))\n    \n    # Add a Total Cost column\n    cost_data$Total_Cost <- cost_data$Loading_Cost + cost_data$Transport_cost\n    \n    # Format currency values\n    cost_data$Loading_Cost <- formatC(cost_data$Loading_Cost, format=\"f\", digits=0, big.mark=\",\")\n    cost_data$Transport_cost <- formatC(cost_data$Transport_cost, format=\"f\", digits=0, big.mark=\",\")\n    cost_data$Total_Cost <- formatC(cost_data$Total_Cost, format=\"f\", digits=0, big.mark=\",\")\n    \n    datatable(cost_data,\n              options = list(\n                pageLength = 10,\n                dom = 'Bfrtip',\n                buttons = c('copy', 'csv', 'excel'),\n                initComplete = JS(\n                  \"function(settings, json) {\",\n                  \"$(this.api().table().header()).css({'background-color': '#3b5998', 'color': 'white'});\",\n                  \"}\"\n                ),\n                columnDefs = list(\n                  list(className = 'dt-center', targets = \"_all\")\n                )\n              ),\n              rownames = FALSE,\n              class = 'compact stripe hover') |>\n      formatStyle(\n        'Warehouse',\n        backgroundColor = styleEqual(\n          paste(\"WH\", 1:5), \n          c('#FFC3A0', '#A0D2FF', '#C8FFB0', '#D5A0FF', '#FFF0A0')\n        )\n      ) |>\n      formatStyle(\n        'DC',\n        backgroundColor = styleEqual(\n          c(\"DC 1\", \"DC 2\", \"DC 3\"), \n          c('#FFDDC3', '#C3E5FF', '#DDFFC3')\n        )\n      )\n  })\n  \n  \n  # Create and render the Sankey diagram\n  selected_indices <- reactive({\n    as.numeric(sub(\"Warehouse \", \"\", input$warehouse))\n  })\n  \n  # Filter data based on selected warehouses\n  filtered_data <- reactive({\n    result |>\n      filter(Warehouse %in% paste(\"WH\",input$warehouse))\n  })\n\n  # Create and render the Sankey diagram\n  output$sankey_diagram <- renderUI({\n    req(length(selected_indices()) > 0)\n    \n    # Create links data frame\n    links <- data.frame()\n    \n    # Add links for each selected warehouse\n    for (i in 1:length(selected_indices())) {\n      wh_idx <- selected_indices()[i]\n      wh_data <- optimal_quantities[wh_idx, , drop = FALSE]\n      \n      # Add links for each DC\n      for (j in 1:ncol(wh_data)) {\n        if (wh_data[1, j] > 0) {\n          links <- rbind(links, data.frame(\n            source = i - 1,  # Use index in selected warehouses (0-based)\n            target = length(selected_indices()) + j - 1,  # DCs come after warehouses\n            value = wh_data[1, j]\n          ))\n        }\n      }\n    }\n    \n    # Only proceed if we have links\n    req(nrow(links) > 0)\n    \n    # Create nodes data frame\n    nodes <- data.frame(\n      name = c(paste(\"Warehouse\", selected_indices()), paste(\"DC\", 1:3))\n    )\n    \n    # Create the Sankey network\n    sankey <- sankeyNetwork(\n      Links = links, \n      Nodes = nodes, \n      Source = \"source\", \n      Target = \"target\", \n      Value = \"value\",\n      NodeID = \"name\",\n      height = 500,  \n      width = 800,\n      fontSize = 12,\n      nodeWidth = 20,\n      sinksRight = TRUE\n    )\n    \n    # Customize tooltips and add click functionality to show a value panel\n    sankey <- htmlwidgets::onRender(sankey, \"\n    function(el, x) {\n      // Create a div for the value panel\n      var valuePanel = d3.select('body').append('div')\n        .attr('class', 'value-panel')\n        .style('position', 'absolute')\n        .style('padding', '8px')\n        .style('background', 'lightgray')\n        .style('border', '1px solid gray')\n        .style('border-radius', '4px')\n        .style('opacity', 0);  // Start hidden\n\n      // Append title for tooltips on hover\n      d3.selectAll('.link')\n        .append('title')\n        .text(function(d) { return 'Quantity: ' + d.value.toFixed(2); });  // Show value on hover\n\n      // Add click event to show the value panel\n      d3.selectAll('.link')\n        .on('click', function(event, d) {\n          // Ensure we get the correct value\n          var value = d3.select(this).datum().value;\n          var source = nodes.name[d.source.index];\n          var target = nodes.name[d.target.index];\n\n          // Position the value panel near the mouse cursor\n          valuePanel\n            .style('left', (event.pageX + 5) + 'px')\n            .style('top', (event.pageY + 5) + 'px')\n            .style('opacity', 1)  // Make it visible\n            .html('From: ' + source + '<br>To: ' + target + '<br>Quantity: ' + value.toFixed(2));  // Set the text with details\n\n          // Hide the panel after a delay\n          setTimeout(function() {\n            valuePanel.style('opacity', 0);\n          }, 3000);  // Change the delay as needed\n        });\n    }\n    \")\n    \n    # Add title and caption\n    tagList(\n      sankey,\n      tags$p(style = \"font-size: 12px; text-align: right;\", \n             \"A wider arrow indicates that a larger quantity is being sent from that warehouse to a distribution center.\")\n    )\n  })\n  \n  # Add a summary statistics output at the bottom of the map tab\n  output$summary_stats <- renderUI({\n    req(location())\n    \n    selected_data <- result |> \n      filter(Warehouse %in% paste(\"WH\", location()))\n    \n    total_loading <- sum(selected_data$Loading_Cost)\n    total_transport <- sum(selected_data$Transport_cost)\n    total_weight <- sum(selected_data$Total_Weight)\n    \n    div(\n      class = \"mt-3 p-3 bg-light rounded\",\n      h4(\"Summary Statistics\", class = \"text-primary mb-3\"),\n      div(class = \"row\",\n          div(class = \"col-md-4\",\n              div(class = \"card text-white bg-primary mb-3\",\n                  div(class = \"card-body\",\n                      h5(class = \"card-title\", \"Total Weight\"),\n                      h3(class = \"card-text\", paste0(round(total_weight, 2), \" tons\"))\n                  )\n              )\n          ),\n          div(class = \"col-md-4\",\n              div(class = \"card text-white bg-success mb-3\",\n                  div(class = \"card-body\",\n                      h5(class = \"card-title\", \"Total Loading Cost\"),\n                      h3(class = \"card-text\", paste0(\"â‚«\", formatC(total_loading, format=\"f\", digits=0, big.mark=\",\")))\n                  )\n              )\n          ),\n          div(class = \"col-md-4\",\n              div(class = \"card text-white bg-info mb-3\",\n                  div(class = \"card-body\",\n                      h5(class = \"card-title\", \"Total Transport Cost\"),\n                      h3(class = \"card-text\", paste0(\"â‚«\", formatC(total_transport, format=\"f\", digits=0, big.mark=\",\")))\n                  )\n              )\n          )\n      )\n    )\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n:::\n\nBáº¡n cÃ³ thá»ƒ tháº¥y vá»›i **dashboard** nhÆ° váº­y, ta cÃ³ thá»ƒ xem Ä‘Æ°á»£c nhiá»u thÃ´ng tin hÆ¡n nhÆ°:\n\n-   Vá»‹ trÃ­ cá»¥ thá»ƒ cá»§a tá»«ng *WH* vÃ  *DC* cÅ©ng nhÆ° lÃ  cÃ¡c tuyáº¿n Ä‘Æ°á»ng dá»± kiáº¿n báº±ng cÃ¡c Ä‘Æ°á»ng tháº³ng minh há»a. (Xem **Map tab**)\n\n-   ThÃ´ng tin vá» chi phÃ­ *Loading cost* vÃ  *Transporation cost* cÅ©ng nhÆ° lÆ°á»£ng hÃ ng cáº§n váº­n chuyá»ƒn cho tá»«ng nhÃ  kho. (Xem **Table and Sankey tab**)\n\nBáº¡n cÃ³ thá»ƒ xem cho 1 hoáº·c nhiá»u nhÃ  kho báº±ng cÃ¡ch *click* trÃªn thanh **Filter**. NgoÃ i ra, Ä‘áº·c biá»‡t vá»›i **Sankey chart**, báº¡n cáº§n giá»¯ hoáº·c *click* chuá»™t vÃ o tuyáº¿n Ä‘á»ƒ xem Ä‘Æ°á»£c sá»‘ lÆ°á»£ng hÃ ng.\n\nTuy ráº¥t thÃ­ch R nhÆ°ng mÃ¬nh váº«n khÃ´ng thÃ­ch xÃ¢y dá»±ng dashboard báº±ng R láº¯m vÃ¬ quÃ¡ náº·ng vá» code vÃ  khÃ´ng hiá»‡u quáº£ vá» thá»i gian, nguá»“n lá»±c. CÃ¡c tools khÃ¡c mÃ¬nh Æ°u tiÃªn hÆ¡n nhÆ° **Power BI**, **Tableau** hoáº·c cÃ¡c **BIs** mÃ  cÃ´ng ty báº¡n sá»­ dá»¥ng trong cÃ´ng viá»‡c háº±ng ngÃ y.\n\n\n```{=html}\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Go to Next Page</title>\n    <style>\n        /* Global Styles */\n        body {\n            font-family: 'Tahoma', sans-serif;\n            display: flex;\n            flex-direction: column;  /* Stack content and footnote vertically */\n            justify-content: center;  /* Center content vertically */\n            align-items: center;      /* Center content horizontally */\n            margin: 0;\n            background-color: $secondary-color;\n            box-sizing: border-box;\n            min-height: 80vh; /* Adjusted to 80vh to ensure it's not too high */\n        }\n\n        /* Container Styling (Main Content) */\n        .container {\n            text-align: center;\n            padding: 20px 40px; /* Adjust padding for more compactness */\n            background-color: white;\n            border-radius: 12px;\n            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);\n            width: auto;  /* Auto width to fit content */\n            max-width: 380px;  /* Adjusted max-width for a smaller container */\n            box-sizing: border-box;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            flex-direction: column;\n            margin-top: 20px;  /* Space from the top of the page */\n        }\n\n        /* Link Styling */\n        .link {\n            font-size: 20px;  /* Adjusted font size for readability */\n            color: #007bff;\n            text-decoration: none;\n            font-weight: 700;\n            display: inline-flex;\n            align-items: center;\n            cursor: pointer;\n            padding: 12px 30px;\n            border-radius: 6px;\n            transition: all 0.3s ease;\n        }\n\n        .link:hover {\n            color: #0056b3;\n            text-decoration: none;\n            background-color: #e6f0ff;\n        }\n\n        /* Arrow Styling */\n        .arrow {\n            margin-left: 12px;\n            font-size: 24px;\n            transition: transform 0.3s ease, font-size 0.3s ease;\n        }\n\n        .link:hover .arrow {\n            transform: translateX(8px);\n            font-size: 26px;\n        }\n\n        /* Focus State for Accessibility */\n        .link:focus {\n            outline: 2px solid #0056b3;\n        }\n\n        /* Footer Styling (Footnote) */\n        .footer {\n            font-size: 14px;\n            color: #777;\n            margin-top: 20px;  /* Space between content and footnote */\n            text-align: center;\n            width: 100%;\n        }\n\n        /* Mobile-Friendly Adjustments */\n        @media (max-width: 600px) {\n            .link {\n                font-size: 18px;\n                padding: 8px 15px;  /* Smaller padding for mobile devices */\n            }\n\n            .arrow {\n                font-size: 18px;\n                margin-left: 8px;\n            }\n\n            .container {\n                padding: 15px 30px;  /* Smaller padding on mobile */\n                max-width: 90%;  /* Ensure container fits better on small screens */\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <a href=\"https://loccx78vn.github.io/genetic-algorithm-method/MILP.html\" class=\"link\" tabindex=\"0\">\n            Go to Next Page\n            <span class=\"arrow\">â”</span>\n        </a>\n    </div>\n</body>\n</html>\n```\n","srcMarkdownNoYaml":"\n\n# Giá»›i thiá»‡u:\n\n```{r}\n#| warning: false\n#| message: false\n#| echo: false\n#Call packages\npacman::p_load(rio,\n               here,\n               janitor,\n               tidyverse,\n               dplyr,\n               magrittr,\n               ggplot2,\n               purrr,\n               lubridate,\n               mice,\n               plotly,\n               DiagrammeR,\n               shinylive)\n```\n\n## VÃ i Ä‘iá»ƒm vá» thuáº­t toÃ¡n Genetic:\n\n**GA** hay **Genetic Algorithm** lÃ  1 thuáº­t toÃ¡n tá»‘i Æ°u hÃ³a ngáº«u nhiÃªn (**stochastic search algorithms**), Ä‘Æ°á»£c phÃ¡t triá»ƒn dá»±a trÃªn lÃ½ thuyáº¿t tiáº¿n hÃ³a vÃ  sá»± chá»n lá»c tá»± nhiÃªn cá»§a sinh há»c [@lucascrucca2013].\n\ná» thá»i cáº¥p 3, báº¡n Ä‘Ã£ tá»«ng há»c vá» lÃ½ thuyáº¿t tiáº¿n hÃ³a vÃ  chá»n lá»c tá»± nhiÃªn cá»§a [Charles Darwin](https://vi.wikipedia.org/wiki/Charles_Darwin) vÃ  [Alfred Russel](https://vi.wikipedia.org/wiki/Alfred_Russel_Wallace) á»Ÿ mÃ´n Sinh há»c. Náº¿u báº¡n cÅ©ng tá»«ng liá»‡t Sinh nhÆ° tÃ´i thÃ¬ báº¡n quÃªn cÅ©ng khÃ´ng sao ğŸ˜…ğŸ˜…. Váº­y thÃ¬ Ä‘á»ƒ tÃ´i giáº£i thÃ­ch láº¡i nhÆ° sau:\n\nSá»± tiáº¿n hÃ³a lÃ  sá»± thay Ä‘á»•i Ä‘áº·c Ä‘iá»ƒm di truyá»n cá»§a 1 quáº§n thá»ƒ sinh váº­t, vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh chÃ­nh lÃ  tá»« loáº¡i vÆ°á»£n Ä‘Ã£ tiáº¿n hÃ³a thÃ nh hÃ¬nh dáº¡ng con ngÆ°á»i vÄƒn minh nhÆ° cÃ¡c báº¡n bÃ¢y giá». Váº­y quÃ¡ trÃ¬nh tiáº¿n hÃ³a Ä‘Ã³ diá»…n ra khi cÃ³ sá»± chá»n lá»c tá»± nhiÃªn táº¡o ra cÃ¡c biáº¿n dá»‹ di truyá»n (VÃ­ dá»¥: Ä‘á»™t biáº¿n,...) vÃ  káº¿t quáº£ lÃ  cÃ¡c cÃ¡ thá»ƒ Ä‘á»™t biáº¿n trá»Ÿ nÃªn phá»• biáº¿n hÆ¡n hoáº·c hiáº¿m gáº·p hÆ¡n trong quáº§n thá»ƒ. Váº­y Ä‘iá»u kiá»‡n Ä‘á»ƒ xáº£y ra sá»± chá»n lá»c tá»± nhiÃªn cÃ³ thá»ƒ lÃ  sá»± thay Ä‘á»•i vá» mÃ´i trÆ°á»ng sá»‘ng, Ä‘á»‹a lÃ½,... dáº«n tá»›i sá»± khÃ¡c nhau vá» kháº£ nÄƒng sá»‘ng sÃ³t vÃ  sinh sáº£n.\n\nKáº¿t cá»¥c lÃ  xuáº¥t hiá»‡n cÃ¡c cÃ¡ thá»ƒ Ä‘á»™t biáº¿n \"máº¡nh máº½ hÆ¡n\" hoáº·c Ä‘Ãºng lÃ  \"Ä‘áº·c biá»‡t hÆ¡n\" cÃ³ kháº£ nÄƒng tá»“n táº¡i khi xuáº¥t hiá»‡n sá»± thay Ä‘á»•i lá»›n, vÃ­ dá»¥ nhÆ° dÆ°á»›i Ä‘Ã¢y, do sá»± thay Ä‘á»•i vá» Ä‘á»‹a Ä‘iá»ƒm sá»‘ng, tá»« má»™t loáº¡i chim sáº» Ä‘Ã£ phÃ¡t triá»ƒn thÃ nh 3 phÃ¢n há» khÃ¡c nhau.\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/Natural_selection.jpg\" style=\"max-width: 80%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 1: VÃ­ dá»¥ vá» chá»n lá»c tá»± nhiÃªn\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://www.biologyonline.com/dictionary/natural-selection\">Link to Image</a>\n  </div>\n</div>\n```\n\nVáº­y lÃ­ thuyáº¿t nÃ y liÃªn quan gÃ¬ tá»›i váº¥n Ä‘á» tá»‘i Æ°u hÃ³a. ThÃ´ng thÆ°á»ng khi báº¡n muá»‘n tá»‘i Æ°u hÃ³a má»™t váº¥n Ä‘á» gÃ¬ Ä‘Ã³, báº¡n cáº§n xÃ¢y dá»±ng mÃ´ hÃ¬nh Ä‘á»‹nh lÆ°á»£ng nÃ³, vÃ­ dá»¥ nhÆ° dÆ°á»›i áº£nh nÃ y ta Ä‘ang cÃ³ mÃ´ hÃ¬nh [MILP](https://www.mathworks.com/help/optim/ug/mixed-integer-linear-programming-algorithms.html) nháº±m hoáº¡ch Ä‘á»‹nh tuyáº¿n Ä‘Æ°á»ng vÃ  tá»‘i Æ°u hÃ³a quÃ£ng Ä‘Æ°á»ng di chuyá»ƒn.\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/MILP.png\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 2: MÃ´ hÃ¬nh VRP\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://medium.com/@rihot_gusron/capacitated-vehicle-routing-problem-with-lingo-427c2d3bf724\">Link to Image</a>\n  </div>\n</div>\n```\n\nMá»¥c tiÃªu cá»§a hÃ m chÃ­nh lÃ  tÃ¬m ra giÃ¡ trá»‹ nhá» nháº¥t nghÄ©a lÃ  chi phÃ­ cho viá»‡c di chuyá»ƒn cá»§a xe lÃ  nhá» nháº¥t. Do Ä‘Ã³, báº¡n cÃ³ thá»ƒ hÃ¬nh dung ráº±ng **giÃ¡ trá»‹ nhá» nháº¥t** Ä‘Ã³ nhÆ° lÃ  cÃ¡c **cÃ¡ thá»ƒ Ä‘á»™t biáº¿n** cÃ³ kháº£ nÄƒng sá»‘ng sÃ³t cao nháº¥t trong quáº©n thá»ƒ.\n\nVÃ¬ váº­y thuáº­t toÃ¡n **Genetic** (GA) chÃ­nh lÃ  láº·p Ä‘i láº·p láº¡i sá»± chá»n lá»c tá»± nhiÃªn trong má»™t quáº§n thá»ƒ hoáº·c má»™t máº«u Ä‘á»ƒ Ä‘áº¿n cuá»‘i cÃ¹ng tÃ¬m ra cÃ¡ thá»ƒ vÆ°á»£t trá»™i nháº¥t.\n\n## CÃ¡ch hoáº¡t Ä‘á»™ng GA trong ML:\n\nTrong Machine Learning, GA nháº±m tÃ¬m ra Ä‘Ãºng cÃ¡c biáº¿n cáº§n thiáº¿t Ä‘á»ƒ xÃ¢y dá»±ng mÃ´ hÃ¬nh tá»‘t nháº¥t. Gá»‰a sá»­ chÃºng ta cÃ³ 2 mÃ´ hÃ¬nh lÃ :\n\n-   MÃ´ hÃ¬nh 1: gá»“m cÃ¡c biáº¿n A,C,D.\n-   MÃ´ hÃ¬nh 2: gá»“m biáº¿n A,B,E.\n\nVáº­y mÃ´ hÃ¬nh nÃ o má»›i lÃ  tá»‘t nháº¥t cho mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n ? ChÃºng ta chÆ°a biáº¿t Ä‘Æ°á»£c vÃ  chá»‰ cÃ³ thá»ƒ so sÃ¡nh nÃ³ thÃ´ng qua thuáº­t toÃ¡n Genetic.\n\nVá» quy trÃ¬nh, thuáº­t toÃ¡n Genetic sáº½ cÃ³ cÃ¡ch hoáº¡t Ä‘á»™ng nhÆ° dÆ°á»›i Ä‘Ã¢y. Quy trÃ¬nh nÃ y mÃ¬nh tham kháº£o cá»§a [@rohithgandhi2018].\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/Genetic_Algorithm.png\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 3: Thuáº­t toÃ¡n Genetic\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://medium.datadriveninvestor.com/genetic-algorithms-9f920939f7cc\">Link to Image</a>\n  </div>\n</div>\n```\n\nDiá»…n giáº£i cÃ¡ch hoáº¡t Ä‘á»™ng:\n\n-   BÆ°á»›c 1 (**Initialisation**): má»—i biáº¿n Ä‘Æ°á»£c xem lÃ  *Gene* vÃ  nhiá»u *Gene* gá»™p láº¡i thÃ nh má»™t mÃ´ hÃ¬nh hay gá»i lÃ  *Chromosome* vÃ  nhiá»u *Chromosome* sáº½ táº¡o thÃ nh má»™t quáº§n thá»ƒ (*Population*). Viá»‡c nÃ y giá»‘ng nhÆ° lÃ  báº¡n Ä‘ang trÃ¬nh bÃ y háº¿t cÃ¡c phÆ°Æ¡ng Ã¡n cÃ³ thá»ƒ sá»­ dá»¥ng.\n\n```{=html}\n<div style=\"text-align: center; margin-bottom: 20px;\">\n  <img src=\"img/Term.png\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\">\n  \n  <!-- Picture Name -->\n  <div style=\"text-align: left; margin-top: 10px;\">\n    HÃ¬nh 4: CÃ¡c thuáº­t ngá»¯ trong GA\n  </div>\n  \n  <!-- Source Link -->\n  <div style=\"text-align: right; font-style: italic; margin-top: 5px;\">\n    Source: <a href=\"https://www.doc.ic.ac.uk/research/technicalreports/2003/DTR03-4.pdf\">Link to Image</a>\n  </div>\n</div>\n```\n\n-   BÆ°á»›c 2 (**Fitness Function**): Báº¡n cáº§n xÃ¢y dá»±ng má»™t hÃ m má»¥c tiÃªu Ä‘á»ƒ tÃ­nh toÃ¡n giÃ¡ trá»‹ cho cÃ¡c mÃ´ hÃ¬nh á»Ÿ bÆ°á»›c 1.\n\n-   BÆ°á»›c 3 (**Selection**): Biáº¿n nÃ o cÃ³ giÃ¡ trá»‹ yáº¿u kÃ©m sáº½ bá»‹ loáº¡i vÃ  quÃ¡ trÃ¬nh tÃ­nh toÃ¡n sáº½ tiáº¿p tá»¥c á»Ÿ tháº¿ há»‡ cá»§a nÃ³ tiáº¿p theo. Diá»…n giáº£i Ä‘Æ¡n giáº£n hÆ¡n lÃ  chÃºng ta thá»­ má»™t cÃ¡ch khÃ¡c vÃ  cá»‘ gáº¯ng cáº£i thiá»‡n káº¿t quáº£.\n\n-   BÆ°á»›c 4 (**Crossover**): Táº¡o ra mÃ´ hÃ¬nh gá»“m cÃ¡c biáº¿n tá»‘t Ä‘Ã£ lá»±a chá»n á»Ÿ bÆ°á»›c 3. VÃ­ dá»¥ nhÆ° biáº¿n A, B lÃ  tá»‘t cho mÃ´ hÃ¬nh.\n\n-   BÆ°á»›c 5 (**Mutation**): Thay Ä‘á»•i mÃ´ hÃ¬nh Ä‘áº§u vÃ o Ä‘Ã£ bao gá»“m cÃ¡c biáº¿n á»Ÿ bÆ°á»›c 4 vÃ  báº¯t Ä‘áº§u láº¡i tá»« bÆ°á»›c 1. VÃ­ dá»¥ mÃ´ hÃ¬nh cáº§n chá»n gá»“m 5 biáº¿n vÃ  ta Ä‘Ã£ chá»n Ä‘Æ°á»£c biáº¿n A,B lÃ  tá»‘t. Do Ä‘Ã³, khi quay láº¡i bÆ°á»›c 1, ta chá»‰ cáº§n chá»n thÃªm 3 biáº¿n thay vÃ¬ 5 biáº¿n nhÆ° thÃ´ng thÆ°á»ng.\n\n# Thá»±c hÃ nh trong R:\n\nSau khi Ä‘Ã£ sÆ¡ lÆ°á»£c vá» thuáº­t toÃ¡n, bÃ¢y giá» ta sáº½ vÃ o pháº§n thá»±c hÃ nh trong R. Váº­y lÃ m sao Ä‘á»ƒ á»©ng dá»¥ng thuáº­t toÃ¡n Genetic trong R, mÃ¬nh Ä‘Ã£ kham kháº£o qua nhiá»u nguá»“n tÃ i liá»‡u vÃ  tá»•ng há»£p dÆ°á»›i Ä‘Ã¢y:\n\n**XÃ¢y dá»±ng hÃ m má»¥c tiÃªu**: hÃ m má»¥c tiÃªu lÃ  bÆ°á»›c quan trá»ng nháº¥t trong thuáº­t toÃ¡n Genetic vÃ¬ nÃ³ lÃ  cÆ¡ sá»Ÿ Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ vÃ  lá»±a chá»n cÃ¡ thá»ƒ vÆ°á»£t trá»™i nháº¥t. VÃ  hÃ m má»¥c tiÃªu sáº½ luÃ´n khÃ¡c nhau tÃ¹y vÃ o váº¥n Ä‘á» mÃ  ta Ä‘áº·t ra. Giáº£ sá»­ chÃºng ta muá»‘n tá»‘i Æ°u chi phÃ­ thÃ¬ nÃ³ lÃ  hÃ m Min, cÃ²n ta muá»‘n tá»‘i Ä‘a lá»£i nhuáº­n thÃ¬ nÃ³ sáº½ lÃ  hÃ m Max.\n\nVáº­y hÃ m má»¥c tiÃªu cá»§a bÃ i toÃ¡n trÃªn trong R, báº¡n cÃ³ thá»ƒ tham kháº£o pháº§n code bÃªn dÆ°á»›i mÃ¬nh:\n\n::: callout-important\n### Type of fitness function\n\nÄá»‘i sá»‘ `type` trong hÃ m cÃ³ 3 giÃ¡ trá»‹:\n\n-   `\"binary\"`: Ä‘áº¡i diá»‡n cho biáº¿n quyáº¿t Ä‘á»‹nh dáº¡ng phÃ¢n loáº¡i, vÃ­ dá»¥: cÃ³/khÃ´ng\n-   `\"real-valued\"`: dÃ¹ng dá»ƒ tá»‘i Æ°u cho cÃ¡c biáº¿n quyáº¿t Ä‘á»‹nh lÃ  dáº¡ng sá»‘ thá»±c, sá»‘ tá»± nhiÃªn.\n-   `\"permutation\"`: cho cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n viá»‡c sáº¯p xáº¿p láº¡i cÃ¡c biáº¿n thÃ nh danh sÃ¡ch, vÃ­ dá»¥: thang Ä‘o Likert.\n:::\n\nChi tiáº¿t vá» hÃ m `ga()`, báº¡n cÃ³ thá»ƒ tham kháº£o tÃ i liá»‡u cá»§a [@lucascrucca2013].\n\n## Thuáº­t toÃ¡n Genetic:\n\nVáº­y bÃ¢y giá» chÃºng ta sáº½ xá»­ lÃ­ bÃ i toÃ¡n trÃªn theo thuáº­t toÃ¡n **Genetic**\n\nGá»‰a sá»­ chÃºng ta cÃ³ bÃ i toÃ¡n vá» váº­n chuyá»ƒn hÃ ng tá»« nhÃ  kho Ä‘á»ƒ thá»a mÃ£n nhu cáº§u á»Ÿ cÃ¡c Ä‘iá»ƒm **DC (Distribution center)**. VÃ  cÃ´ng thá»©c Ä‘á»ƒ tÃ­nh toÃ¡n Ä‘Æ°á»£c chi phÃ­ lÃ :\n\nHÃ m chi phÃ­ tá»•ng thá»ƒ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh nhÆ° sau:\n\n$$\nTC = \\sum_{i=1}^{m} \\left( D_{ij} \\times \\frac{P}{F} \\times 0.4 + LC_i \\right) \\times Q_j\n$$\n\nTrong bÃ i toÃ¡n nÃ y, báº¡n sáº½ cáº§n dá»¯ liá»‡u Ä‘á»ƒ tÃ­nh toÃ¡n 2 thÃ´ng sá»‘ lÃ : **PhÃ­ bá»‘c xáº¿p (Loading cost)** vÃ  **Chi phÃ­ váº­n chuyá»ƒn (Transportation cost)**.\n\nNáº¿u trong cÃ´ng viá»‡c thÆ°á»ng ngÃ y á»Ÿ cÃ´ng ty, chÃºng ta sáº½ cáº§n láº¥y dá»¯ liá»‡u tá»« **Data warehouse** báº±ng SQL hoáº·c cÃ¡c pháº§n má»m **Business Intelligence** khÃ¡c. á» Ä‘Ã¢y, nháº±m má»¥c Ä‘Ã­ch há»c táº­p, mÃ¬nh Ä‘Ã£ táº¡o ra code á»Ÿ phÃ­a dÆ°á»›i Ä‘á»ƒ xÃ¢y dá»±ng dá»¯ liá»‡u cho cÃ¡c báº¡n luyá»‡n táº­p.\n\n```{r}\n# Create a data frame for loading costs\nloading_costs <- data.frame(\n  Warehouse = rep(paste(\"WH\", 1:5), each = 4),\n  ID = rep(1:5, times = 4),\n  Weight_Category = rep(c(\"< 2 tons\", \"2 to 5 tons\", \"5 to 10 tons\", \"> 10 tons\"), times = 5),\n  Has_Machine = rep(c(\"Yes\", \"No\", \"Yes\", \"No\", \"No\"), each = 4),\n  Loading_Cost = c(80, 100, 120, 160,  # Warehouse 1 (with machine)\n                   110, 150, 180, 210,  # Warehouse 2 (without machine)\n                   85, 105, 125, 140,  # Warehouse 3 (with machine)\n                   150, 170, 190, 210,  # Warehouse 4 (without machine)\n                   140, 165, 185, 215)   # Warehouse 5 (without machine)\n)\n\n# Set seed for reproducibility\nset.seed(123)\n\n# Define parameters\nweight_categories <- c(\"< 1.5\", \"1.5 to 2.5\", \"2.5 to 5\", \"5 to 10\", \"> 10\")\n# Create the data frame\nloading_costs <- data.frame(\n  Warehouse = rep(1:5, each = 15),  # 5 warehouses, 15 rows each\n  DC = rep(rep(1:3, each = 5), times = 5),  # Repeat 1, 2, 3 for each warehouse\n  Weight_Category = rep(weight_categories, times = 15),  # Repeat categories for 15 rows\n  Loading_Cost = round(runif(75, 5, 150), 2),\n  Has_Machine = sample(c(\"Yes\", \"No\"), 75, replace = TRUE)\n)\n\n# Define warehouses with coordinates (latitude, longitude)\nwarehouses <- data.frame(\n  ID = 1:5,\n  Latitude = c(21.0285, 16.0545, 10.7769, 14.0583, 19.8060), # Example latitudes (Hanoi, HCMC, Da Nang, etc.)\n  Longitude = c(105.804, 108.2022, 106.6957, 108.2772, 105.7460) # Example longitudes\n)\n\n# Define distribution centers data in Vietnam (example coordinates)\ndistribution_centers <- data.frame(\n  ID = 1:3,\n  Demand = c(90, 30, 150),\n  Latitude = c(17.974855, 11.7769, 15.122327), # Example latitudes (Hanoi, Da Nang, HCMC)\n  Longitude = c(102.630867, 106.6957, 108.799357) # Example longitudes\n)\n```\n\nNáº¿u báº¡n tá»«ng gáº·p khÃ³ khÄƒn trong viá»‡c pháº£i Ä‘á»‘i máº·t vá»›i cáº£ Ä‘á»‘ng dá»¯ liá»‡u tá»« há»‡ thá»‘ng vÃ  chÆ°a biáº¿t láº¥y dá»¯ liá»‡u nÃ o Ä‘á»ƒ phÃ¢n tÃ­ch hoáº·c gá»™p báº£ng nÃ o qua báº£ng nÃ o thÃ¬ lá»i khuyÃªn cá»§a mÃ¬nh lÃ  hÃ£y váº½ báº£ng **Entity relation diagram (ERD)**.\n\n**ERD** lÃ  má»™t cÃ´ng cá»¥ trá»±c quan dÃ¹ng Ä‘á»ƒ mÃ´ táº£ cáº¥u trÃºc dá»¯ liá»‡u trong cÆ¡ sá»Ÿ dá»¯ liá»‡u. ERD thá»ƒ hiá»‡n cÃ¡c thá»±c thá»ƒ (*entities*), thuá»™c tÃ­nh (*attributes*), vÃ  cÃ¡c má»‘i quan há»‡ (*relationships*) giá»¯a chÃºng. CÃ¡c thá»±c thá»ƒ thÆ°á»ng Ä‘Æ°á»£c biá»ƒu diá»…n dÆ°á»›i dáº¡ng hÃ¬nh chá»¯ nháº­t, thuá»™c tÃ­nh dÆ°á»›i dáº¡ng hÃ¬nh ellips, vÃ  má»‘i quan há»‡ báº±ng hÃ¬nh thoi hoáº·c Ä‘Æ°á»ng ná»‘i. ERD giÃºp láº­p káº¿ hoáº¡ch cho thiáº¿t káº¿ cÆ¡ sá»Ÿ dá»¯ liá»‡u, Ä‘áº£m báº£o ráº±ng cÃ¡c yáº¿u tá»‘ dá»¯ liá»‡u vÃ  quan há»‡ giá»¯a chÃºng Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh rÃµ rÃ ng, táº¡o ná»n táº£ng cho viá»‡c phÃ¡t triá»ƒn vÃ  quáº£n lÃ½ dá»¯ liá»‡u hiá»‡u quáº£.\n\nNhÆ° biá»ƒu Ä‘á»“ dÆ°á»›i Ä‘Ã¢y, mÃ¬nh Ä‘ang cÃ³ 3 báº£ng gá»“m:\n\n-   Báº£ng thÃ´ng tin chi tiáº¿t vá» DC.\n\n-   Báº£ng thÃ´ng tin chi tiáº¿t vá» WH.\n\n-   Báº£ng giÃ¡ vá» loading cost vÃ  transportation cost tá»« WH Ä‘áº¿n DC.\n\nVÃ  cÃ¡c báº¡n cÃ³ thá»ƒ dá»… dÃ ng hÃ¬nh dung cÃ¡c má»‘i quan há»‡ thÃ´ng qua báº£ng **Entity relation diagram (ERD)** dÆ°á»›i Ä‘Ã¢y:\n\n```{r}\n#| echo: false\n#| fig-subcap: \"Biá»ƒu Ä‘á»“ 1: EDR model\"\nlibrary(datamodelr)\n# Create the data model from your data frames\ndm1 <- dm_from_data_frames(list(\n  Warehouses = warehouses,\n  Loading_Costs = loading_costs,\n  Distribution_Centers = distribution_centers\n)) |>\n  dm_set_key(\"Warehouses\", \"ID\") |>\n  dm_set_key(\"Loading_Costs\", c(\"Warehouse\", \"DC\")) |>\n  dm_set_key(\"Distribution_Centers\", \"ID\") |>\n  dm_add_references(\n    Loading_Costs$Warehouse == Warehouses$ID,  # Correct reference\n    Loading_Costs$DC == Distribution_Centers$ID  # Assuming this is the correct reference\n  )\n\n# Create and render the ERD\ndm_create_graph(dm1, rankdir = \"LR\", columnArrows = TRUE) |>\n  dm_render_graph()\n```\n\n::: callout-tip\n### Táº£i package datamodelr:\n\nMÃ¬nh táº¡o biá»ƒu Ä‘á»“ nÃ y báº±ng thÆ° viá»‡n `datamodelr`. Báº¡n cÃ³ thá»ƒ táº£i báº±ng cÃº phÃ¡p: `devtools::install_github(\"bergant/datamodelr\")`\n:::\n\n### Dá»¯ liá»‡u Ä‘áº§u vÃ o:\n\nNhÆ° váº­y, dá»±a vÃ o Ä‘Ã³, ta sáº½ tÃ­nh toÃ¡n Ä‘Æ°á»£c 2 *matrix* vá» chi phÃ­:\n\n-   Báº£ng giÃ¡ loading á»Ÿ cÃ¡c kho. (HÃ¬nh bÃªn trÃ¡i)\n\n-   Báº£ng chi phÃ­ váº­n chuyá»ƒn tá»« tá»«ng WH Ä‘áº¿n cÃ¡c DCs. (HÃ¬nh bÃªn pháº£i)\n\n```{r}\n#| warning: false\n#| message: false\n## Calculate the transportation cost:\n# Haversine distance function\nhaversine <- function(lat1, lon1, lat2, lon2) {\n  R <- 6371 # Radius of Earth in kilometers\n  dlat <- (lat2 - lat1) * pi / 180\n  dlon <- (lon2 - lon1) * pi / 180\n  a <- sin(dlat / 2) * sin(dlat / 2) +\n       cos(lat1 * pi / 180) * cos(lat2 * pi / 180) * \n       sin(dlon / 2) * sin(dlon / 2)\n  c <- 2 * atan2(sqrt(a), sqrt(1 - a))\n  R * c # Distance in kilometers\n}\n\n# Calculate distance matrix based on coordinates\ndistance_matrix <- matrix(0, nrow = nrow(warehouses), ncol = nrow(distribution_centers))\n\nfor (i in 1:nrow(warehouses)) {\n  for (j in 1:nrow(distribution_centers)) {\n    distance_matrix[i, j] <- haversine(\n      warehouses$Latitude[i], warehouses$Longitude[i],\n      distribution_centers$Latitude[j], distribution_centers$Longitude[j]\n    )\n  }\n}\n\n# Define the fuel price (example value)\nfuel_price <- 20 # Fuel price per kilometer\n\n# Calculate transportation costs\ntransportation_costs <- distance_matrix * fuel_price * 0.4\n\n## Calculate the loading cost:\nweights_per_good <- 0.1\n\nmean_loading_cost<-loading_costs |> \n  group_by(DC, Warehouse) |> \n  summarise(mean = mean(Loading_Cost,na.rm = TRUE)/1000/weights_per_good) |> # Assumes weighted of goods is 0.1kg \n  ungroup()\n\nlibrary(data.table)\n# Reshape the data frame to a wide format\nmean_cost_matrix <- reshape2::dcast(mean_loading_cost,\n                          Warehouse ~ DC, \n                          value.var = \"mean\")\n\n# Convert the data frame to a matrix and remove the Warehouse column\nloading_costs_per_dc <- as.matrix(mean_cost_matrix[,-1])\n\n# Set row names as the warehouse names\nrownames(loading_costs_per_dc) <- mean_loading_cost$Warehouse[!duplicated(mean_loading_cost$Warehouse)]\n```\n\n\n::: {.panel-tabset}\n\n#### Báº£ng chi phÃ­ bá»‘c xáº¿p\n\n```{r}\n#| warning: false\n#| message: false\n#| echo: false\n#| fig-cap: [\"Biá»ƒu Ä‘á»“ 2: Heatmap cho báº£ng chi phÃ­ bá»‘c xáº¿p\"]\n# Code táº¡o hai biá»ƒu Ä‘á»“\n\nlibrary(ggplot2)\n\n# Convert the distance matrix to a data frame\ndistance_df <- reshape2::melt(transportation_costs)\ncolnames(distance_df) <- c(\"Warehouse\", \"Distribution_Center\", \"Transportation_Cost\")\n\n# Plot the distance matrix with updated colors\nggplot(distance_df, aes(x = Warehouse, \n                        y = Distribution_Center, \n                        fill = Transportation_Cost)) +\n  geom_tile(color = \"white\", linewidth = 0.5) +  # Add borders to tiles\n  geom_text(aes(label = scales::comma(Transportation_Cost, accuracy = 1)), \n            color = ifelse(distance_df$Transportation_Cost > \n                           max(distance_df$Transportation_Cost)/2, \"white\", \"black\"),\n            size = 3.5) +  # Adaptive text color\n  scale_fill_gradient2(\n    low = \"#f7fbff\", \n    mid = \"#6baed6\", \n    high = \"#08519c\",\n    midpoint = median(distance_df$Transportation_Cost),\n    name = \"Cost (VNÄ)\",\n    labels = scales::comma\n  ) +\n  theme_minimal() +\n  labs(\n    title = \"Transportation Costs Between Facilities\",\n    subtitle = \"Costs shown in Vietnamese Dong (VNÄ)\",\n    x = \"Warehouse\",\n    y = \"Distribution Center\"\n  ) +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1, face = \"bold\", size = 12),\n    axis.text.y = element_text(face = \"bold\", size = 12),\n    axis.title.x = element_text(size = 14, face = \"bold\", margin = margin(t = 15)),\n    axis.title.y = element_text(size = 14, face = \"bold\", margin = margin(r = 15)),\n    plot.title = element_text(face = \"bold\", size = 16),\n    plot.subtitle = element_text(size = 12, color = \"gray30\"),\n    panel.grid = element_blank(),  # Remove grid lines\n    legend.position = \"right\"\n  )\n\n```\n\n\n#### Báº£ng giÃ¡ váº­n chuyá»ƒn:\n\n```{r}\n#| warning: false\n#| message: false\n#| echo: false\n#| fig-cap: [\"Biá»ƒu Ä‘á»“ 3: Báº£ng giÃ¡ váº­n chuyá»ƒn tá»« WH Ä‘áº¿n DC\"]\n# Convert the transportation costs matrix to a data frame\nlibrary(gt)\nlibrary(gtExtras)\n# Create a gt table\nm<-loading_costs |>\n  mutate(Loading_Cost = Loading_Cost * 1000,\n         DC = paste(\"DC\",DC),\n         Warehouse = paste(\"WH\",Warehouse)) # Convert to currency\n  \nhead(m[order(-m$Loading_Cost),]) |> \n  gt() |>\n  fmt_currency(\n    columns = Loading_Cost,\n    currency = \"VND\",\n    decimals = 0,\n    use_seps = TRUE\n  ) |>\n  tab_header(\n    title = md(\"**Loading Costs by weight category in each warehouses**\"),\n    subtitle = md(\"Table just contains **expected loading cost**\")\n  ) |>  \n  opt_align_table_header(align = \"center\") |> \n  cols_label(\n    Loading_Cost = \"Loading Cost (VNÄ)\",\n    Weight_Category = \"Weight Category\",\n    Has_Machine = \"Has Machine\",\n    DC = \"Distribution Center\"\n  ) |> \n  data_color(method = \"numeric\",\n             palette = \"viridis\",\n             reverse = TRUE) |> \n  gt_theme_pff() |> \n  tab_style(style = list(cell_text(align = \"center\")),\n            locations = cells_body(columns = everything())) |>\n  tab_style(\n    style = list(\n      cell_text(align = \"center\")\n    ),\n    locations = list(\n      cells_column_labels(everything())\n    )\n  ) |> \n  tab_source_note(source = md(\"*Source: package gt in R*\")) |> \n  tab_style(\n    style = \"font-weight: bold\",\n    locations = cells_body(Weight_Category)\n  )\n  \n```\n\n:::\n\n### XÃ¢y dá»±ng hÃ m má»¥c tiÃªu:\n\nSau khi Ä‘Ã£ cÃ³ Ä‘á»§ dá»¯ liá»‡u, báº¡n sáº½ báº¯t Ä‘áº§u viáº¿t hÃ m má»¥c tiÃªu vÃ  dÃ¹ng thuáº­t toÃ¡n GA Ä‘á»ƒ tÃ¬m ra giÃ¡ trá»‹ tá»‘i Æ°u nháº¥t.\n\nTrong hÃ m `ga` tá»« gÃ³i **GA** trong R, cÃ³ má»™t sá»‘ Ä‘á»‘i sá»‘ quan trá»ng cho phÃ©p báº¡n tÃ¹y chá»‰nh thuáº­t toÃ¡n di truyá»n. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t cÃ¡i nhÃ¬n tá»•ng quan vá» má»™t sá»‘ Ä‘á»‘i sá»‘ quan trá»ng:\n\n-   **type**: Chá»‰ Ä‘á»‹nh loáº¡i tá»‘i Æ°u hÃ³a (vÃ­ dá»¥: `\"real-valued\"`, `\"binary\"` hoáº·c `\"permutation\"`).\n\n-   **fitness**: HÃ m Ä‘Ã¡nh giÃ¡ Ä‘á»™ phÃ¹ há»£p; nÃ³ nÃªn nháº­n má»™t vector tham sá»‘ lÃ m Ä‘áº§u vÃ o vÃ  tráº£ vá» má»™t giÃ¡ trá»‹ sá»‘.\n\n-   **lower** vÃ  **upper**: Äá»‹nh nghÄ©a giá»›i háº¡n cho cÃ¡c biáº¿n náº¿u báº¡n Ä‘ang tá»‘i Æ°u hÃ³a trong khÃ´ng gian liÃªn tá»¥c (dÃ¹ng cho cÃ¡c loáº¡i giÃ¡ trá»‹ thá»±c).\n\n-   **popSize**: Thiáº¿t láº­p kÃ­ch thÆ°á»›c quáº§n thá»ƒ cho má»—i tháº¿ há»‡.\n\n-   **maxiter**: Chá»‰ Ä‘á»‹nh sá»‘ tháº¿ há»‡ tá»‘i Ä‘a Ä‘á»ƒ cháº¡y thuáº­t toÃ¡n.\n\n-   **run**: Chá»‰ Ä‘á»‹nh sá»‘ tháº¿ há»‡ Ä‘á»ƒ cháº¡y thuáº­t toÃ¡n mÃ  khÃ´ng cÃ³ sá»± cáº£i thiá»‡n trÆ°á»›c khi dá»«ng láº¡i.\n\n-   **pmutation**: XÃ¡c suáº¥t xáº£y ra Ä‘á»™t biáº¿n trong quáº§n thá»ƒ.\n\n-   **elitism**: XÃ¡c Ä‘á»‹nh xem cÃ¡c cÃ¡ thá»ƒ tá»‘t nháº¥t cÃ³ nÃªn Ä‘Æ°á»£c giá»¯ láº¡i trong tháº¿ há»‡ tiáº¿p theo hay khÃ´ng.\n\nNhá»¯ng Ä‘á»‘i sá»‘ nÃ y giÃºp Ä‘iá»u chá»‰nh thuáº­t toÃ¡n di truyá»n cho cÃ¡c nhu cáº§u tá»‘i Æ°u hÃ³a cá»¥ thá»ƒ cá»§a báº¡n, cho phÃ©p hiá»‡u suáº¥t tá»‘t hÆ¡n vÃ  há»™i tá»¥ vá» cÃ¡c giáº£i phÃ¡p tá»‘i Æ°u.\n\nNgoÃ i ra, cÃ²n cÃ³ cÃ¡c lÆ°u Ã½ cho báº¡n khi sá»­ dá»¥ng R nhÆ° sau:\n\n::: callout-caution\n##### LÆ°u Ã½ khi dÃ¹ng hÃ m ga():\n\nHÃ m `ga()` pháº£i cÃ³ Ã­t nháº¥t 2 Ä‘á»‘i sá»‘ lÃ  `type` vÃ  `fitness thÃ¬ R má»›i cháº¡y Ä‘Æ°á»£c.`\n\n-   RiÃªng khi type = \"binary\" thÃ¬ cáº§n thÃªm Ä‘á»‘i sá»‘ `nBits.`\n\n-   CÃ²n khi `type = \"real-valued\"/\"permutation\"` thÃ¬ cáº§n thÃªm Ä‘á»‘i sá»‘ `min` vÃ  `max`.\n:::\n\n```{r}\n#| message: false\n#| warning: false\n#| output: false\n# Load necessary library\nlibrary(GA)\ndemand<-c(distribution_centers$Demand)\n\n# Define the objective function\nobjective_function <- function(quantities) {\n    quantities_matrix <- matrix(quantities, \n                                nrow = 5, \n                                ncol = 3, \n                                byrow = TRUE)\n    \n    # Calculate total loading costs\n    loading_costs <- rowSums(quantities_matrix) * loading_costs_per_dc  # Total loading costs for each DC\n    # Calculate total transportation costs\n    transportation_costs <- sum(quantities_matrix * transportation_costs)\n    \n    # Combine both costs\n    total_cost <- sum(loading_costs) + transportation_costs\n    \n    # Check if demands are met\n    if (any(colSums(quantities_matrix) < demand)) {\n        return(Inf)  # Penalize if demands are not met\n    }\n    \n    return(total_cost)\n}\n\n# Set up the Genetic Algorithm\nnum_vars <- 5 * 3  # 5 warehouses, 3 distribution centers\nga_result <- ga(\n    type = \"real-valued\",\n    fitness = function(x) -objective_function(x),  # Negate for minimization\n    lower = rep(0, num_vars),  # Minimum quantity\n    upper = rep(100, num_vars),  # Maximum quantity (adjust as needed)\n    popSize = 50,\n    maxiter = 100,\n    run = 10,\n    monitor = TRUE\n)\n```\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n# Print the summary of the GA result\nplot(ga_result)\n# Assuming ga_result@solution contains optimal quantities\nga_result_solution <- c(ga_result@solution)\n\n# Reshape the solution into a matrix (5 warehouses x 3 DCs)\noptimal_quantities <- matrix(ga_result@solution,\n                             nrow = 5, \n                             ncol = 3, \n                             byrow = TRUE)\n\n# Convert the matrix to a data frame\nweights<-optimal_quantities* weights_per_good\n\nrownames(weights) <- 1:5\ncolnames(weights) <- 1:3\n\nlibrary(reshape2)\nreal_weighted <- melt(weights)\n\n# Rename the columns\ncolnames(real_weighted) <- c(\"Warehouse\", \"DC\", \"Total_Weight\")\n\n# Perform left join\nresult <- real_weighted |>\n  left_join(loading_costs, by = c(\"Warehouse\", \"DC\"))\n\nresult <-result |> \n  mutate(Price = case_when(\n    Total_Weight < 1.5 ~ \"< 1.5\",\n    Total_Weight <2.5 ~ \"1.5 to 2.5\",\n    Total_Weight < 5 ~ \"2.5 to 5\",\n    Total_Weight < 10 ~ \"5 to 10\",\n    Total_Weight >= 10 ~ \"> 10\",\n      is.na(Total_Weight) ~ NA_character_  # Handle NA explicitly if needed\n  ))\n  \nresult<-result |> \n  filter(Weight_Category == Price) |> \n  select(-Price)\n\n# Join with tranportation cost table:\nrownames(transportation_costs) <- 1:5\ncolnames(transportation_costs) <- 1:3\n\ntransport<-melt(transportation_costs)\n\n# Rename the columns\ncolnames(transport) <- c(\"Warehouse\", \"DC\", \"Transport_cost\")\n\n\nresult<-left_join(result,\n                  transport,\n                  by=c(\"Warehouse\", \"DC\"))\n\n# Adjust:\n\nresult<-result |> \n      mutate(Loading_Cost = Loading_Cost*1000,\n             Transport_cost = Transport_cost*1000,\n             DC = paste(\"DC\",DC),\n             Warehouse = paste(\"WH\",Warehouse)) \n\n# Reorder cols in table:\nresult<-result[,c(\"Warehouse\",\n                 \"DC\",\n                 \"Has_Machine\",\n                 \"Total_Weight\",\n                 \"Weight_Category\",\n                 \"Loading_Cost\",\n                 \"Transport_cost\")]\n```\n\nKáº¿t quáº£ tá»‘i Æ°u sáº½ Ä‘Æ°á»£c trÃ¬nh bÃ y á»Ÿ báº£ng nÃ y (hÆ¡i mÃ u mÃ¨ 1 tÃ­!!!)\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\nlibrary(gt)\nlibrary(dplyr)\nlibrary(scales)\n\n# Add Total_Cost column and Has_Machine_Icon\nresult <- result |> \n  mutate(\n    Total_Cost = Loading_Cost + Transport_cost,\n    Has_Machine_Icon = ifelse(Has_Machine == \"Yes\", \"âœ…\", \"âŒ\")\n  ) |> \n  select(-Has_Machine)\n\n# Find the row with highest total cost\nmax_total_cost <- max(result$Total_Cost, na.rm = TRUE)\n\n# Build enhanced GT table\nresult |>\n  gt() |>\n  tab_header(\n    title = html(\"<b>ğŸ“¦ Warehouse Shipment Summary</b>\"),\n    subtitle = md(\"Cost Breakdown & Machine Availability\")\n  ) |>\n  fmt_currency(\n    columns = c(Loading_Cost, Transport_cost, Total_Cost),\n    currency = \"USD\"\n  ) |>\n  fmt_number(\n    columns = Total_Weight,\n    decimals = 2\n  ) |>\n  data_color(\n    columns = Total_Weight,\n    colors = col_numeric(\n      palette = c(\"lightblue\", \"blue\"),\n      domain = NULL\n    )\n  ) |>\n  data_color(\n    columns = Loading_Cost,\n    colors = col_numeric(\n      palette = c(\"lightyellow\", \"orange\"),\n      domain = NULL\n    )\n  ) |>\n  data_color(\n    columns = Transport_cost,\n    colors = col_numeric(\n      palette = c(\"lightpink\", \"deeppink\"),\n      domain = NULL\n    )\n  ) |>\n  data_color(\n    columns = Total_Cost,\n    colors = col_numeric(\n      palette = c(\"lightgreen\", \"forestgreen\"),\n      domain = NULL\n    )\n  ) |>\n  tab_style(\n    style = cell_text(weight = \"bold\"),\n    locations = cells_body(\n      columns = vars(Total_Cost),\n      rows = Total_Cost == max_total_cost\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"lightgray\"),\n    locations = cells_body(\n      columns = vars(Has_Machine_Icon),\n      rows = Has_Machine_Icon == \"âœ…\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#f5e1f7\"),\n    locations = cells_body(\n      columns = vars(Has_Machine_Icon),\n      rows = Has_Machine_Icon == \"âŒ\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#fdf5e6\"),\n    locations = cells_body(\n      columns = vars(Weight_Category),\n      rows = Weight_Category == \"Light\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#ffe4b5\"),\n    locations = cells_body(\n      columns = vars(Weight_Category),\n      rows = Weight_Category == \"Medium\"\n    )\n  ) |>\n  tab_style(\n    style = cell_fill(color = \"#ffcccb\"),\n    locations = cells_body(\n      columns = vars(Weight_Category),\n      rows = Weight_Category == \"Heavy\"\n    )\n  ) |> \n  cols_label(\n  Warehouse = \"ğŸ¢ Warehouse\",\n  DC = \"ğŸ¬ Distribution Center\",\n  Has_Machine_Icon = \"ğŸ›  Machine\",\n  Total_Weight = \"ğŸ“¦ Total Weight (kg)\",\n  Weight_Category = \"âš–ï¸ Weight Category\",\n  Loading_Cost = \"ğŸ’¼ Loading Cost\",\n  Transport_cost = \"ğŸšš Transport Cost\",\n  Total_Cost = \"ğŸ’° Total Cost\"\n) |>\ntab_style(\n  style = cell_text(weight = \"bold\"),\n  locations = cells_column_labels(columns = everything())\n) |> \n  opt_row_striping()\n```\n\n# BÃ¡o cÃ¡o:\n\nVÃ  cuá»‘i cÃ¹ng, sau khi cÃ³ káº¿t quáº£, mÃ¬nh sáº½ dÃ¹ng cÃ¡c thÆ° viá»‡n gá»“m: **Leaflet**, **gt**, vÃ  **biá»ƒu Ä‘á»“ Sankey** phá»¥c vá»¥ nhá»¯ng má»¥c Ä‘Ã­ch khÃ¡c nhau cho trá»±c quan hÃ³a dá»¯ liá»‡u.\n\n1.  **Leaflet**: ÄÃ¢y lÃ  má»™t thÆ° viá»‡n máº¡nh máº½ Ä‘á»ƒ táº¡o báº£n Ä‘á»“ tÆ°Æ¡ng tÃ¡c. NÃ³ cho phÃ©p ngÆ°á»i dÃ¹ng dá»… dÃ ng thÃªm cÃ¡c lá»›p, Ä‘iá»ƒm Ä‘Ã¡nh dáº¥u vÃ  pop-up, ráº¥t lÃ½ tÆ°á»Ÿng Ä‘á»ƒ trá»±c quan hÃ³a dá»¯ liá»‡u Ä‘á»‹a lÃ½. Leaflet Ä‘áº·c biá»‡t há»¯u Ã­ch Ä‘á»ƒ hiá»ƒn thá»‹ cÃ¡c dá»¯ liá»‡u nhÆ° vá»‹ trÃ­, lá»™ trÃ¬nh, hoáº·c phÃ¢n bá»‘ khÃ´ng gian.\n\n2.  **gt**: GÃ³i **gt** Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ táº¡o ra cÃ¡c báº£ng cháº¥t lÆ°á»£ng cao trong R. NÃ³ cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘á»‹nh dáº¡ng vÃ  táº¡o kiá»ƒu cho báº£ng má»™t cÃ¡ch dá»… dÃ ng, giÃºp chÃºng trá»Ÿ nÃªn háº¥p dáº«n vÃ  dá»… Ä‘á»c. gt há»— trá»£ cÃ¡c tÃ­nh nÄƒng nhÆ° Ä‘á»‹nh dáº¡ng tÃ¹y chá»‰nh, dÃ²ng tÃ³m táº¯t, vÃ  tháº­m chÃ­ thÃªm chÃº thÃ­ch, nÃ¢ng cao cÃ¡ch trÃ¬nh bÃ y dá»¯ liá»‡u trong bÃ¡o cÃ¡o.\n\n3.  **Biá»ƒu Ä‘á»“ Sankey**: Nhá»¯ng biá»ƒu Ä‘á»“ nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ trá»±c quan hÃ³a luá»“ng vÃ  má»‘i quan há»‡ giá»¯a cÃ¡c danh má»¥c khÃ¡c nhau. Trong R, gÃ³i **networkD3** hoáº·c **ggalluvial** cÃ³ thá»ƒ táº¡o ra biá»ƒu Ä‘á»“ Sankey, giÃºp hiá»ƒu cÃ¡ch cÃ¡c giÃ¡ trá»‹ di chuyá»ƒn giá»¯a cÃ¡c nÃºt, cháº³ng háº¡n nhÆ° theo dÃµi hÃ nh trÃ¬nh ngÆ°á»i dÃ¹ng hoáº·c hiá»ƒn thá»‹ phÃ¢n bá»• tÃ i nguyÃªn.\n\nÄá»ƒ káº¿t ná»‘i cÃ¡c biá»ƒu Ä‘á»“ láº¡i vá»›i nhau, ta thÆ°á»ng nghÄ© Ä‘áº¿n `Shiny` trong **R** nhÆ°ng vÃ¬ chÃºng ta Ä‘ang táº¡o website báº±ng **Quarto** nÃªn output cuá»‘i cÃ¹ng sáº½ lÃ  má»™t trang web tÄ©nh - *static website*. Do Ä‘Ã³, nÃ³ sáº½ khÃ´ng pháº£n há»“i vá»›i thÃ´ng tin Ä‘áº§u vÃ o cá»§a ngÆ°á»i dÃ¹ng hoáº·c cháº¡y báº¥t ká»³ mÃ£ R nÃ o. Báº¡n cÃ³ thá»ƒ hÃ¬nh dung giá»‘ng nhÆ° báº¡n Ä‘ang muá»‘n xem biá»ƒu Ä‘á»“ vá» doanh thu trong thÃ¡ng tiáº¿p theo trÃªn 1 biá»ƒu Ä‘á»“ trong Word - khÃ´ng thá»ƒ lÃ m Ä‘Æ°á»£c vÃ¬ nÃ³ thuá»™c dáº¡ng vÄƒn báº£n, báº¡n chá»‰ Ä‘á»c hoáº·c nhÃ¬n chá»© khÃ´ng tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c.\n\nTuy váº­y, sau má»™t thá»i gian tÃ¬m hiá»ƒu, mÃ¬nh cÅ©ng tÃ¬m Ä‘Æ°á»£c cÃ¡ch Ä‘á»ƒ nhÃºng **Shiny** vÃ o R Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn Quarto. Nguá»“n tÃ i liá»‡u báº¡n cÃ³ thá»ƒ kham kháº£o á»Ÿ trang nÃ y [r-shinylive-demo](https://github.com/coatless-quarto/r-shinylive-demo).\n\n::: {.callout-note}\n**Shinylive** lÃ  1 extension cá»§a Quarto vÃ  Ä‘Æ°á»£c kÃ­ch hoáº¡t báº±ng: \n```yaml\nfilter:\n  - quarto-ext/shinylive\n```\ncÃ¡c extension trong filter sáº½ áº£nh hÆ°á»Ÿng Ä‘áº¿n káº¿t quáº£ sau khi Quarto render xong. App Shiny chá»‰ xuáº¥t hiá»‡n sau Ä‘Ã³, nÃªn báº¡n cáº§n Ä‘á»£i thÃªm tÃ¹y theo Ä‘á»™ náº·ng cá»§a app.\n::: \n\n:::{.column-page}\n\n```{shinylive-r}\n#| viewerHeight: 1000\n#| standalone: true\n#| fig-cap: \"Biá»ƒu Ä‘á»“ 3: Dashboard vá» lá»‹ch trÃ¬nh váº­n chuyá»ƒn hÃ ng dá»± tÃ­nh\"\npacman::p_load(\n  leaflet,\n  dplyr,\n  networkD3,\n  shiny,\n  bslib,\n  DT,\n  htmltools\n)\n\n# Add value:\n# Convert GA solution to a matrix\n# Optimal quantities matrix\noptimal_quantities <- matrix(c(\n  43.306058, 10.87137, 13.26283,\n  15.524054, 30.42748, 48.86716,\n  7.599769, 44.93531, 27.46289,\n  18.556927, 17.60396, 41.85203,\n  16.305016, 13.15498, 21.79634\n), nrow = 5, ncol = 3, byrow = TRUE)\n\n# Warehouse data:\nwarehouses <- data.frame(\n  ID = 1:5,\n  Latitude = c(21.0285, 16.0545, 10.7769, 14.0583, 19.8060),\n  Longitude = c(105.8040, 108.2022, 106.6957, 108.2772, 105.7460),\n  District = c(\"Äá»‘ng Äa\", \"Háº£i ChÃ¢u\", \"Quáº­n 1\", \"Mang Yang\", \"ÄÃ´ng SÆ¡n\"),\n  Province = c(\"HÃ  Ná»™i\", \"ÄÃ  Náºµng\", \"Há»“ ChÃ­ Minh\", \"Gia Lai\", \"Thanh HÃ³a\"),\n  Address = c(\n    \"2RH3+9HX Äá»‘ng Äa, HÃ  Ná»™i, Viá»‡t Nam\",\n    \"3632+RV4 Háº£i ChÃ¢u, ÄÃ  Náºµng, Viá»‡t Nam\",\n    \"QMGW+Q74 Quáº­n 1, Há»“ ChÃ­ Minh, Viá»‡t Nam\",\n    \"375G+8VG Mang Yang, Gia Lai, Viá»‡t Nam\",\n    \"RP4W+99X ÄÃ´ng SÆ¡n, Thanh HÃ³a, Viá»‡t Nam\"\n  )\n)\n\n# Distribution center data:\ndistribution_centers <- data.frame(\n  ID = 1:3,\n  Latitude = c(17.97486, 11.77690, 15.12233),\n  Longitude = c(102.6309, 106.6957, 108.7994),\n  District = c(\"ViÃªng ChÄƒn\", \"Lá»™c Ninh\", \"Quáº£ng NgÃ£i\"),\n  Province = c(\"LÃ o\", \"BÃ¬nh PhÆ°á»›c\", \"Quáº£ng NgÃ£i\"),\n  Address = c(\n    \"XJFJ+W8X ViÃªng ChÄƒn, LÃ o\",\n    \"QMGW+Q74 Lá»™c Ninh, BÃ¬nh PhÆ°á»›c, Viá»‡t Nam\",\n    \"4QCX+WPQ Quáº£ng NgÃ£i, Viá»‡t Nam\"\n  )\n)\n\n# Create a data frame with the warehouse data\nresult <- data.frame(\n  Warehouse = c(\"WH 1\", \"WH 2\", \"WH 3\", \"WH 4\", \"WH 5\",\n                \"WH 1\", \"WH 2\", \"WH 3\", \"WH 4\", \"WH 5\",\n                \"WH 1\", \"WH 2\", \"WH 3\", \"WH 4\", \"WH 5\"),\n  DC = c(\"DC 1\", \"DC 1\", \"DC 1\", \"DC 1\", \"DC 1\",\n         \"DC 2\", \"DC 2\", \"DC 2\", \"DC 2\", \"DC 2\",\n         \"DC 3\", \"DC 3\", \"DC 3\", \"DC 3\", \"DC 3\"),\n  Has_Machine = c(\"Yes\", \"No\", \"No\", \"No\", \"No\",\n                  \"No\", \"No\", \"No\", \"No\", \"No\",\n                  \"No\", \"No\", \"No\", \"No\", \"No\"),\n  Total_Weight = c(4.3306058, 1.5524054, 0.7599769, 1.8556927, 1.6305016,\n                   1.0871366, 3.0427479, 4.4935308, 1.7603961, 1.3154977,\n                   1.3262832, 4.8867159, 2.7462887, 4.1852028, 2.1796338),\n  Weight_Category = c(\"2.5 to 5\", \"1.5 to 2.5\", \"< 1.5\", \"1.5 to 2.5\", \"1.5 to 2.5\",\n                      \"< 1.5\", \"2.5 to 5\", \"2.5 to 5\", \"1.5 to 2.5\", \"< 1.5\",\n                      \"< 1.5\", \"2.5 to 5\", \"2.5 to 5\", \"2.5 to 5\", \"1.5 to 2.5\"),\n  Loading_Cost = c(64300, 40680, 144640, 38790, 18750,\n                   11610, 97870, 36380, 69120, 70030,\n                   143740, 91150, 64990, 114230, 96240),\n  Transport_cost = c(3802097.2, 5037171.3, 7297102.2, 5952559.7, 3086494.5,\n                     8264855.3, 4021256.9, 889559.4, 2449208.3, 7188382.3,\n                     5831987.6, 974375.3, 4273915.6, 1047828.2, 4905804.6)\n)\n\n# Custom icon:\nwarehouse_icon <- makeIcon(\n  iconUrl = \"https://raw.githubusercontent.com/Loccx78vn/genetic-algorithm-method/refs/heads/main/img/warehouse_icon.png\",\n  iconWidth = 30,\n  iconHeight = 30\n)\n\ndc_icon <- makeIcon(\n  iconUrl = \"https://raw.githubusercontent.com/Loccx78vn/genetic-algorithm-method/refs/heads/main/img/distribution_center.png\",\n  iconWidth = 30,\n  iconHeight = 30\n)\n# Define a custom theme\nmy_theme <- bs_theme(\n  version = 5,\n  bootswatch = \"litera\",\n  primary = \"#3b5998\",\n  secondary = \"#5cb85c\",\n  success = \"#5cb85c\",\n  info = \"#5bc0de\",\n  warning = \"#f0ad4e\",\n  danger = \"#d9534f\"\n)\n\n# Define UI\nui <- page_fluid(\n  theme = my_theme,\n  \n  # Custom CSS for better visualization\n  tags$head(\n    tags$style(HTML(\"\n      .card-header {\n        background-color: #3b5998;\n        color: white;\n        font-weight: bold;\n      }\n      .nav-tabs .nav-link.active {\n        font-weight: bold;\n        color: #3b5998;\n        border-bottom: 2px solid #3b5998;\n      }\n      .nav-tabs .nav-link {\n        color: #6c757d;\n      }\n      .checkbox span {\n        font-weight: normal;\n      }\n      .checkbox input:checked + span {\n        font-weight: bold;\n        color: #3b5998;\n      }\n      .warehouse-selection {\n        border-left: 4px solid #3b5998;\n        padding-left: 10px;\n      }\n      .dataTables_wrapper {\n        padding: 10px;\n        border-radius: 5px;\n      }\n      .table thead th {\n        background-color: #e9ecef;\n      }\n      .leaflet-container {\n        border-radius: 8px;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      }\n      .sankey-container {\n        border: 1px solid #dee2e6;\n        border-radius: 8px;\n        padding: 10px;\n        background-color: #f8f9fa;\n      }\n      .summary-stats {\n        background-color: #f8f9fa;\n        border-radius: 5px;\n        padding: 10px;\n        margin-bottom: 15px;\n        border-left: 4px solid #3b5998;\n      }\n    \"))\n  ),\n  \n  # Page header - simplified\n  card(\n    card_header(\n      tags$div(\n        class = \"d-flex align-items-center\",\n        tags$img(\n          src = \"https://raw.githubusercontent.com/Loccx78vn/genetic-algorithm-method/refs/heads/main/img/supply-chain-management.png\", \n          height = \"30px\", \n          style = \"margin-right: 10px;\"\n        ),\n        h3(\"Warehouse Distribution Dashboard\", class = \"m-0\")\n      )\n    ),\n    card_body(\n      \"This dashboard shows the optimal distribution of goods from warehouses to distribution centers.\"\n    )\n  ),\n  \n  layout_sidebar(\n    sidebar = sidebar(\n      title = \"Controls\",\n      width = 300,\n      bg = \"#f8f9fa\",\n      class = \"warehouse-selection\",\n      \n      h4(\"Warehouse Selection\", class = \"mb-3 text-primary\"),\n      \n      p(\"Select one or more warehouses to view their distribution data on the map and in the charts.\"),\n      \n      checkboxGroupInput(\n        inputId = \"warehouse\", \n        label = NULL, \n        choices = setNames(\n          paste(\"Warehouse\", 1:5),\n          paste(\"Warehouse\", 1:5, \"-\", warehouses$District, \",\", warehouses$Province)\n        ),\n        selected = paste(\"Warehouse\", 1)\n      ),\n      \n      hr(),\n      \n      tags$div(\n        class = \"alert alert-info\",\n        icon(\"info-circle\"), \n        \"Click on the map markers for detailed location information.\"\n      )\n    ),\n    \n    # Main content - restructured to put summary above map\n    tabsetPanel(\n      tabPanel(\n        title = \"Interactive Map\", \n        icon = icon(\"map\"),\n        card(\n          full_screen = TRUE,\n          height = \"650px\", # Increased height\n          card_body(\n            # Summary stats placed above the map\n            tags$div(\n              class = \"summary-stats\",\n              uiOutput(\"summary_stats\")\n            ),\n            # Map with increased height\n            leafletOutput(\"map\", height = \"550px\") # Increased map height\n          )\n        )\n      ),\n      \n      tabPanel(\n        title = \"Cost Analysis\", \n        icon = icon(\"table\"),\n        card(\n          full_screen = TRUE,\n          height = \"650px\", # Increased to match\n          card_header(\"Cost Table\"),\n          DTOutput(\"cost_table\")\n        )\n      ),\n      \n      tabPanel(\n        title = \"Flow Diagram\", \n        icon = icon(\"diagram-project\"),\n        card(\n          full_screen = TRUE,\n          height = \"650px\", # Increased to match\n          card_header(\"Distribution Flow Diagram\"),\n          tags$div(\n            class = \"sankey-container\",\n            uiOutput(\"sankey_diagram\")\n          )\n        )\n      )\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output, session) {\n  \n  location <- reactive({\n    req(input$warehouse) \n    as.numeric(sub(\"Warehouse \", \"\", input$warehouse))\n  })\n  \n  # Create the leaflet map\n  output$map <- renderLeaflet({\n    req(location())\n    \n    # Color palette for routes\n    route_colors <- c(\"#FF5733\", \"#33A8FF\", \"#33FF57\", \"#D433FF\", \"#FFD133\")\n    \n    # Initialize the map\n    map <- leaflet() |>\n      addTiles() |>\n      addProviderTiles(providers$CartoDB.Positron) |>\n      addMarkers(data = warehouses |> filter(ID %in% location()), \n                 lat = ~Latitude, \n                 lng = ~Longitude, \n                 label = ~paste0(\"<strong> ID Warehouse: </strong> \", ID, \"<br/> \",\n                                 \"<strong> Province: </strong> \", Province, \"<br/> \",\n                                 \"<strong> District: </strong> \", District, \"<br/> \",\n                                 \"<strong> Address: </strong> \", Address, \"<br/> \") |> \n                   lapply(htmltools::HTML),\n                 icon = warehouse_icon) |>\n      addMarkers(data = distribution_centers, \n                 lat = ~Latitude, \n                 lng = ~Longitude, \n                 label = ~paste0(\"<strong> ID Distribution Center: </strong> \", ID, \"<br/> \",\n                                 \"<strong> Province: </strong> \", Province, \"<br/> \",\n                                 \"<strong> District: </strong> \", District, \"<br/> \",\n                                 \"<strong> Address: </strong> \", Address, \"<br/> \") |> \n                   lapply(htmltools::HTML),\n                 icon = dc_icon)\n    \n    qty_data <- optimal_quantities[location(), , drop = FALSE]  \n    \n    # Add routes based on the optimal quantities with different colors\n    route_colors <- c(\"#FF5733\", \"#33A8FF\", \"#33FF57\", \"#D433FF\", \"#FFD133\")\n    line_weights <- c(2, 3, 4, 5, 6)  # Variable line weights based on quantity\n    \n    # Add routes based on the optimal quantities\n    for (i in seq_along(location())) {\n      wh_id <- location()[i]\n      wh_idx <- which(warehouses$ID == wh_id)\n      color_idx <- (wh_id - 1) %% length(route_colors) + 1\n      \n      for (j in 1:ncol(qty_data)) {\n        if (qty_data[i, j] > 0) {\n          route_start <- warehouses[warehouses$ID == wh_id, c(\"Longitude\", \"Latitude\")]\n          route_end <- distribution_centers[distribution_centers$ID == j, c(\"Longitude\", \"Latitude\")]\n          \n          # Calculate line weight based on quantity (normalized)\n          weight_multiplier <- qty_data[i, j] / max(optimal_quantities) * 5\n          weight <- max(2, min(6, weight_multiplier + 2))  # Scale between 2-6\n          \n          map <- map |>\n            addPolylines(\n              lat = c(route_start$Latitude, route_end$Latitude),\n              lng = c(route_start$Longitude, route_end$Longitude),\n              color = route_colors[color_idx],\n              weight = weight,\n              opacity = 0.7,\n              label = paste0(\"Quantity: \", round(qty_data[i, j], 2)),\n              dashArray = \"5, 5\",\n              popup = paste0(\n                \"<strong>From:</strong> Warehouse \", wh_id,\n                \"<br><strong>To:</strong> Distribution Center \", j,\n                \"<br><strong>Quantity:</strong> \", round(qty_data[i, j], 2)\n              )\n            )\n        }\n      }\n    }\n    \n    map  # Return the modified map\n  })\n  \n  # Render the cost table\n  output$cost_table <- renderDT({\n    req(location())\n    \n    cost_data <- result |> \n      filter(Warehouse %in% paste(\"WH\", location())) |> \n      select(c(Warehouse, DC, Loading_Cost, Transport_cost))\n    \n    # Add a Total Cost column\n    cost_data$Total_Cost <- cost_data$Loading_Cost + cost_data$Transport_cost\n    \n    # Format currency values\n    cost_data$Loading_Cost <- formatC(cost_data$Loading_Cost, format=\"f\", digits=0, big.mark=\",\")\n    cost_data$Transport_cost <- formatC(cost_data$Transport_cost, format=\"f\", digits=0, big.mark=\",\")\n    cost_data$Total_Cost <- formatC(cost_data$Total_Cost, format=\"f\", digits=0, big.mark=\",\")\n    \n    datatable(cost_data,\n              options = list(\n                pageLength = 10,\n                dom = 'Bfrtip',\n                buttons = c('copy', 'csv', 'excel'),\n                initComplete = JS(\n                  \"function(settings, json) {\",\n                  \"$(this.api().table().header()).css({'background-color': '#3b5998', 'color': 'white'});\",\n                  \"}\"\n                ),\n                columnDefs = list(\n                  list(className = 'dt-center', targets = \"_all\")\n                )\n              ),\n              rownames = FALSE,\n              class = 'compact stripe hover') |>\n      formatStyle(\n        'Warehouse',\n        backgroundColor = styleEqual(\n          paste(\"WH\", 1:5), \n          c('#FFC3A0', '#A0D2FF', '#C8FFB0', '#D5A0FF', '#FFF0A0')\n        )\n      ) |>\n      formatStyle(\n        'DC',\n        backgroundColor = styleEqual(\n          c(\"DC 1\", \"DC 2\", \"DC 3\"), \n          c('#FFDDC3', '#C3E5FF', '#DDFFC3')\n        )\n      )\n  })\n  \n  \n  # Create and render the Sankey diagram\n  selected_indices <- reactive({\n    as.numeric(sub(\"Warehouse \", \"\", input$warehouse))\n  })\n  \n  # Filter data based on selected warehouses\n  filtered_data <- reactive({\n    result |>\n      filter(Warehouse %in% paste(\"WH\",input$warehouse))\n  })\n\n  # Create and render the Sankey diagram\n  output$sankey_diagram <- renderUI({\n    req(length(selected_indices()) > 0)\n    \n    # Create links data frame\n    links <- data.frame()\n    \n    # Add links for each selected warehouse\n    for (i in 1:length(selected_indices())) {\n      wh_idx <- selected_indices()[i]\n      wh_data <- optimal_quantities[wh_idx, , drop = FALSE]\n      \n      # Add links for each DC\n      for (j in 1:ncol(wh_data)) {\n        if (wh_data[1, j] > 0) {\n          links <- rbind(links, data.frame(\n            source = i - 1,  # Use index in selected warehouses (0-based)\n            target = length(selected_indices()) + j - 1,  # DCs come after warehouses\n            value = wh_data[1, j]\n          ))\n        }\n      }\n    }\n    \n    # Only proceed if we have links\n    req(nrow(links) > 0)\n    \n    # Create nodes data frame\n    nodes <- data.frame(\n      name = c(paste(\"Warehouse\", selected_indices()), paste(\"DC\", 1:3))\n    )\n    \n    # Create the Sankey network\n    sankey <- sankeyNetwork(\n      Links = links, \n      Nodes = nodes, \n      Source = \"source\", \n      Target = \"target\", \n      Value = \"value\",\n      NodeID = \"name\",\n      height = 500,  \n      width = 800,\n      fontSize = 12,\n      nodeWidth = 20,\n      sinksRight = TRUE\n    )\n    \n    # Customize tooltips and add click functionality to show a value panel\n    sankey <- htmlwidgets::onRender(sankey, \"\n    function(el, x) {\n      // Create a div for the value panel\n      var valuePanel = d3.select('body').append('div')\n        .attr('class', 'value-panel')\n        .style('position', 'absolute')\n        .style('padding', '8px')\n        .style('background', 'lightgray')\n        .style('border', '1px solid gray')\n        .style('border-radius', '4px')\n        .style('opacity', 0);  // Start hidden\n\n      // Append title for tooltips on hover\n      d3.selectAll('.link')\n        .append('title')\n        .text(function(d) { return 'Quantity: ' + d.value.toFixed(2); });  // Show value on hover\n\n      // Add click event to show the value panel\n      d3.selectAll('.link')\n        .on('click', function(event, d) {\n          // Ensure we get the correct value\n          var value = d3.select(this).datum().value;\n          var source = nodes.name[d.source.index];\n          var target = nodes.name[d.target.index];\n\n          // Position the value panel near the mouse cursor\n          valuePanel\n            .style('left', (event.pageX + 5) + 'px')\n            .style('top', (event.pageY + 5) + 'px')\n            .style('opacity', 1)  // Make it visible\n            .html('From: ' + source + '<br>To: ' + target + '<br>Quantity: ' + value.toFixed(2));  // Set the text with details\n\n          // Hide the panel after a delay\n          setTimeout(function() {\n            valuePanel.style('opacity', 0);\n          }, 3000);  // Change the delay as needed\n        });\n    }\n    \")\n    \n    # Add title and caption\n    tagList(\n      sankey,\n      tags$p(style = \"font-size: 12px; text-align: right;\", \n             \"A wider arrow indicates that a larger quantity is being sent from that warehouse to a distribution center.\")\n    )\n  })\n  \n  # Add a summary statistics output at the bottom of the map tab\n  output$summary_stats <- renderUI({\n    req(location())\n    \n    selected_data <- result |> \n      filter(Warehouse %in% paste(\"WH\", location()))\n    \n    total_loading <- sum(selected_data$Loading_Cost)\n    total_transport <- sum(selected_data$Transport_cost)\n    total_weight <- sum(selected_data$Total_Weight)\n    \n    div(\n      class = \"mt-3 p-3 bg-light rounded\",\n      h4(\"Summary Statistics\", class = \"text-primary mb-3\"),\n      div(class = \"row\",\n          div(class = \"col-md-4\",\n              div(class = \"card text-white bg-primary mb-3\",\n                  div(class = \"card-body\",\n                      h5(class = \"card-title\", \"Total Weight\"),\n                      h3(class = \"card-text\", paste0(round(total_weight, 2), \" tons\"))\n                  )\n              )\n          ),\n          div(class = \"col-md-4\",\n              div(class = \"card text-white bg-success mb-3\",\n                  div(class = \"card-body\",\n                      h5(class = \"card-title\", \"Total Loading Cost\"),\n                      h3(class = \"card-text\", paste0(\"â‚«\", formatC(total_loading, format=\"f\", digits=0, big.mark=\",\")))\n                  )\n              )\n          ),\n          div(class = \"col-md-4\",\n              div(class = \"card text-white bg-info mb-3\",\n                  div(class = \"card-body\",\n                      h5(class = \"card-title\", \"Total Transport Cost\"),\n                      h3(class = \"card-text\", paste0(\"â‚«\", formatC(total_transport, format=\"f\", digits=0, big.mark=\",\")))\n                  )\n              )\n          )\n      )\n    )\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n:::\n\nBáº¡n cÃ³ thá»ƒ tháº¥y vá»›i **dashboard** nhÆ° váº­y, ta cÃ³ thá»ƒ xem Ä‘Æ°á»£c nhiá»u thÃ´ng tin hÆ¡n nhÆ°:\n\n-   Vá»‹ trÃ­ cá»¥ thá»ƒ cá»§a tá»«ng *WH* vÃ  *DC* cÅ©ng nhÆ° lÃ  cÃ¡c tuyáº¿n Ä‘Æ°á»ng dá»± kiáº¿n báº±ng cÃ¡c Ä‘Æ°á»ng tháº³ng minh há»a. (Xem **Map tab**)\n\n-   ThÃ´ng tin vá» chi phÃ­ *Loading cost* vÃ  *Transporation cost* cÅ©ng nhÆ° lÆ°á»£ng hÃ ng cáº§n váº­n chuyá»ƒn cho tá»«ng nhÃ  kho. (Xem **Table and Sankey tab**)\n\nBáº¡n cÃ³ thá»ƒ xem cho 1 hoáº·c nhiá»u nhÃ  kho báº±ng cÃ¡ch *click* trÃªn thanh **Filter**. NgoÃ i ra, Ä‘áº·c biá»‡t vá»›i **Sankey chart**, báº¡n cáº§n giá»¯ hoáº·c *click* chuá»™t vÃ o tuyáº¿n Ä‘á»ƒ xem Ä‘Æ°á»£c sá»‘ lÆ°á»£ng hÃ ng.\n\nTuy ráº¥t thÃ­ch R nhÆ°ng mÃ¬nh váº«n khÃ´ng thÃ­ch xÃ¢y dá»±ng dashboard báº±ng R láº¯m vÃ¬ quÃ¡ náº·ng vá» code vÃ  khÃ´ng hiá»‡u quáº£ vá» thá»i gian, nguá»“n lá»±c. CÃ¡c tools khÃ¡c mÃ¬nh Æ°u tiÃªn hÆ¡n nhÆ° **Power BI**, **Tableau** hoáº·c cÃ¡c **BIs** mÃ  cÃ´ng ty báº¡n sá»­ dá»¥ng trong cÃ´ng viá»‡c háº±ng ngÃ y.\n\n\n```{=html}\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Go to Next Page</title>\n    <style>\n        /* Global Styles */\n        body {\n            font-family: 'Tahoma', sans-serif;\n            display: flex;\n            flex-direction: column;  /* Stack content and footnote vertically */\n            justify-content: center;  /* Center content vertically */\n            align-items: center;      /* Center content horizontally */\n            margin: 0;\n            background-color: $secondary-color;\n            box-sizing: border-box;\n            min-height: 80vh; /* Adjusted to 80vh to ensure it's not too high */\n        }\n\n        /* Container Styling (Main Content) */\n        .container {\n            text-align: center;\n            padding: 20px 40px; /* Adjust padding for more compactness */\n            background-color: white;\n            border-radius: 12px;\n            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);\n            width: auto;  /* Auto width to fit content */\n            max-width: 380px;  /* Adjusted max-width for a smaller container */\n            box-sizing: border-box;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            flex-direction: column;\n            margin-top: 20px;  /* Space from the top of the page */\n        }\n\n        /* Link Styling */\n        .link {\n            font-size: 20px;  /* Adjusted font size for readability */\n            color: #007bff;\n            text-decoration: none;\n            font-weight: 700;\n            display: inline-flex;\n            align-items: center;\n            cursor: pointer;\n            padding: 12px 30px;\n            border-radius: 6px;\n            transition: all 0.3s ease;\n        }\n\n        .link:hover {\n            color: #0056b3;\n            text-decoration: none;\n            background-color: #e6f0ff;\n        }\n\n        /* Arrow Styling */\n        .arrow {\n            margin-left: 12px;\n            font-size: 24px;\n            transition: transform 0.3s ease, font-size 0.3s ease;\n        }\n\n        .link:hover .arrow {\n            transform: translateX(8px);\n            font-size: 26px;\n        }\n\n        /* Focus State for Accessibility */\n        .link:focus {\n            outline: 2px solid #0056b3;\n        }\n\n        /* Footer Styling (Footnote) */\n        .footer {\n            font-size: 14px;\n            color: #777;\n            margin-top: 20px;  /* Space between content and footnote */\n            text-align: center;\n            width: 100%;\n        }\n\n        /* Mobile-Friendly Adjustments */\n        @media (max-width: 600px) {\n            .link {\n                font-size: 18px;\n                padding: 8px 15px;  /* Smaller padding for mobile devices */\n            }\n\n            .arrow {\n                font-size: 18px;\n                margin-left: 8px;\n            }\n\n            .container {\n                padding: 15px 30px;  /* Smaller padding on mobile */\n                max-width: 90%;  /* Ensure container fits better on small screens */\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <a href=\"https://loccx78vn.github.io/genetic-algorithm-method/MILP.html\" class=\"link\" tabindex=\"0\">\n            Go to Next Page\n            <span class=\"arrow\">â”</span>\n        </a>\n    </div>\n</body>\n</html>\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"include-in-header":["toc-filter.html",{"text":"<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css\">\n"}],"number-sections":true,"filters":["quarto-ext/shinylive"],"output-file":"GA.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.31","theme":"theme.scss","grid":{"sidebar-width":"300px","body-width":"900px","margin-width":"400px"},"title":"Genetic Algorithms in R","subtitle":"Viá»‡t Nam, 2024","categories":["SupplyChainManagement","Logistics","Genetic Algorithm"],"description":"ÄÃ¢y lÃ  bÃ i viáº¿t cá»§a tÃ´i vá» cÃ¡ch sá»­ dá»¥ng R trong á»©ng dá»¥ng Genetic Algorithm trong Supply Chain","crossref":{"labels":"alpha a","subref-labels":"roman"},"bibliography":["references.bib"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}